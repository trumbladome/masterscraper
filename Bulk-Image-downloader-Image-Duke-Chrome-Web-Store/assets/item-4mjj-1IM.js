const l={defaultConfig:{dirType:"TITLE",fixedDir:"ImageDuke",widthRange:null,heightRange:null,needRename:!1,renameRule:"pic_{NO001}.{EXT}",outputTextFormat:'<img src="{LINK}"/>',needBlobDomains:[],singleOutput:!0,autoConvertWebp:!0,enableShortkey:!0,shortKeyCurrent:"Z",shortKeyAll:"A",limitConcurrent:10,dragSelect:!0,dragDownload:!0,showUrl:!1,advancedMode:!0,unique:!0,enableContextmenu:!0,enabledMenus:["batchDownload"],rememberFilter:!0,dragDownloadMode:"drag-to-filter-page",previewSize:"small",filenameAltOrOriginal:"alt",sortType:"default",showMore:!0,pagination:!1,recordPageInfo:!1},dirType:"TITLE",fixedDir:"ImageDuke",widthRange:[0,0],heightRange:null,needRename:!1,renameRule:"pic_{NO001}.{EXT}",outputTextFormat:'<img src="{LINK}"/>',needBlobDomains:["service.weibo.com","weibo.com"],singleOutput:!0,autoConvertWebp:!0,enableShortkey:!0,shortKeyCurrent:"Z",shortKeyAll:"A",limitConcurrent:10,dragSelect:!0,dragDownload:!0,showUrl:!1,advancedMode:!0,unique:!0,enableContextmenu:!0,enabledMenus:["batchDownload"],rememberFilter:!0,dragDownloadMode:"drag-to-filter-page",previewSize:"small",filenameAltOrOriginal:"alt",sortType:"default",showMore:!0,pagination:!1,recordPageInfo:!1},c=[{enabled:!0,site:"topit.me",srcPattern:"https?://.{2,}.topit.me/.*",replaceRules:[{pattern:"[/][mst][/]",modifiers:"g",replacement:"/l/"},{pattern:"[mst][.]jpg",modifiers:"g",replacement:"l.jpg"},{pattern:"[/][mst]",modifiers:"g",replacement:"/l"}]},{enabled:!0,site:"新浪微博",srcPattern:"https?://.*[.]sinaimg[.]cn/.*",replaceRules:[{pattern:"[/]small[/]",modifiers:"",replacement:"/large/"},{pattern:"[/]square[/]",modifiers:"",replacement:"/large/"},{pattern:"[/]thumbnail[/]",modifiers:"",replacement:"/large/"},{pattern:"[/]bmiddle[/]",modifiers:"",replacement:"/large/"},{pattern:"[/]thumb[\\d]*[/]",modifiers:"",replacement:"/large/"},{pattern:"[/]mw[\\d]+[/]",modifiers:"",replacement:"/large/"},{pattern:"\\/orj\\d+\\/",modifiers:"",replacement:"/large/"}]},{enabled:!0,site:"QQ相册/空间",srcPattern:"https?://.*[.]photo[.]store[.]qq[.]com/.*",replaceRules:[{pattern:"[/]m[/]",modifiers:"",replacement:"/o/"},{pattern:"&w=[\\d]+&h=[\\d]+",modifiers:"",replacement:""}]},{enabled:!0,site:"QQ相册/空间 - new",srcPattern:"qpic.cn/psb",replaceRules:[{pattern:"/m/",modifiers:"",replacement:"/b/"}]},{enabled:!0,site:"考拉海购",srcPattern:"pop.nosdn.127.net|haitao.nosdn\\d+.127.net|haitao.nos.netease.com",replaceRules:[{pattern:"\\?imageView.*",modifiers:"",replacement:""}]},{enabled:!0,site:"QQ相册2",srcPattern:"https?://group[.]store[.]qq[.]com/.*",replaceRules:[{pattern:"[/]400$",modifiers:"",replacement:"/800"},{pattern:"[/]200$",modifiers:"",replacement:"/800"},{pattern:"[/]100$",modifiers:"",replacement:"/800"}]},{enabled:!0,site:"Twitter",srcPattern:"https://pbs.twimg.com/media/.*\\?format=",replaceRules:[{pattern:"format=(.+?)\\b.*",modifiers:"",replacement:"format=$1&name=4096x4096"}]},{enabled:!0,site:"百度图趣",srcPattern:"https?://hiphotos[.]baidu[.]com/.*",replaceRules:[{pattern:"[/]abpic[/]",modifiers:"",replacement:"/pic/"},{pattern:"[/]pin[/]w=[\\d]+[/].+[/]",modifiers:"",replacement:"/pin/pic/item/"}]},{enabled:!0,site:"豆瓣相册",srcPattern:"https?://img[\\d]*[.]douban(io)?[.]com/.*",replaceRules:[{pattern:"[/]thumb[/]",modifiers:"",replacement:"/photo/"},{pattern:"[/]albumicon[/]",modifiers:"",replacement:"/photo/"},{pattern:"photo/m/",modifiers:"",replacement:"photo/l/"}]},{enabled:!0,site:"花瓣",srcPattern:"https?://img[.]hb[.]aicdn[.]com/.*|hbimg.huabanimg.com",replaceRules:[{pattern:"_fw[\\d]+[w]*$|_\\/fw\\/\\d+.*|_fw[\\d]+.*$",modifiers:"",replacement:""}]},{enabled:!0,site:"Flickr",srcPattern:".*[.]staticflickr[.]com.*",replaceRules:[{pattern:"_[ms]\\.jpg$",modifiers:"",replacement:"_b.jpg"}]},{enabled:!0,site:"Google+",srcPattern:"http.*lh.*\\.googleusercontent\\.com.*",replaceRules:[{pattern:"[/]w\\d+-h\\d+(-n)*-k[/]",modifiers:"",replacement:"/s1600/"}]},{enabled:!0,site:"迅雷方舟",srcPattern:"http.*\\.xlpan\\.kanimg\\.com.*",replaceRules:[{pattern:"&s=.*[\\d]+.*$",modifiers:"",replacement:"&s=1600"}]},{enabled:!0,site:"poco.cn",srcPattern:"http.*image[\\d]*-c.poco.cn.*",replaceRules:[{pattern:"_\\d{3}.jpg$",modifiers:"",replacement:".jpg"}]},{enabled:!0,site:"pconline太平洋摄影",srcPattern:"http.*.pconline.com.cn.*",replaceRules:[{pattern:"_mthumb.jpg$",modifiers:"",replacement:".jpg"},{pattern:"_thumb.jpg$",modifiers:"",replacement:".jpg"}]},{enabled:!0,site:"美丽说",srcPattern:"(http.*[.]meilishuo[.]net.*)|(http.*[.]meiliworks[.]com.*)",replaceRules:[{pattern:"[/]l[/]",modifiers:"",replacement:"/_o/"},{pattern:"[/]r[/]",modifiers:"",replacement:"/_o/"}]},{enabled:!0,site:"蘑菇街",srcPattern:"https?://.*[.]mogujie[.]cn/.*",replaceRules:[{pattern:"_[\\d]{3}x[\\d]+.jpg$",modifiers:"",replacement:"_468x468.jpg"}]},{enabled:!0,site:"又拍网",srcPattern:"https?://photo.yupoo.com/.*.jpg",replaceRules:[{pattern:"(square.jpg$)|(fw200.jpg$)",modifiers:"",replacement:"medish.jpg"}]},{enabled:!0,site:"hao123美图",srcPattern:"http.*img.*[.]hao123[.]com.*",replaceRules:[{pattern:"_310$",modifiers:"",replacement:"_0"}]},{enabled:!0,site:"pinterest",srcPattern:"https?://.*[.]pinimg[.]com/.*.jpg",replaceRules:[{pattern:"[/]2([\\d]+)x[/]",modifiers:"",replacement:"/7$1x/"},{pattern:"474",modifiers:"",replacement:"736"},{pattern:"i.pinimg.com\\/\\d+x\\/",modifiers:"",replacement:"i.pinimg.com/originals/"}]},{enabled:!0,site:"1688",srcPattern:"https?://cbu01.alicdn.com/img/ibank/.*\\..*x.*\\.jpg",replaceRules:[{pattern:"_\\.webp$",modifiers:"",replacement:""},{pattern:"\\.\\d+x\\d+\\.",modifiers:"",replacement:"."},{pattern:".220x220xz.",modifiers:"",replacement:"."}]},{enabled:!0,site:"aliexpress",srcPattern:"aliexpress-media.com",replaceRules:[{pattern:"_\\d+x\\d+\\..*",modifiers:"",replacement:""}]},{enabled:!0,site:"淘宝天猫",srcPattern:"alicdn.com",replaceRules:[{pattern:"_\\.webp",modifiers:"",replacement:""},{pattern:"\\.png\\_\\d+x\\d+\\.png$",modifiers:"",replacement:".png"},{pattern:"\\.jpg\\_\\d+x\\d+\\.jpg$",modifiers:"",replacement:".jpg"},{pattern:"_\\d+x\\d+\\.jpg$",modifiers:"",replacement:"_800x800.jpg"},{pattern:"_\\d+x\\d+[qQ]\\d+\\.jpg.*",modifiers:"",replacement:""},{pattern:"\\.\\d+x\\d+\\.jpg$",modifiers:"",replacement:".jpg"},{pattern:"\\.jpg_\\d+x\\d+xzq\\d+\\.jpg$",modifiers:"",replacement:".jpg"},{pattern:"_640x0q80_\\.webp",modifiers:"",replacement:""},{pattern:"_640x0q80$",modifiers:"",replacement:""},{pattern:"_\\d+x\\d+.*",modifiers:"",replacement:""}]},{enabled:!0,site:"京东",srcPattern:"360buyimg.com/n\\d",replaceRules:[{pattern:"\\/n\\d+\\/",modifiers:"",replacement:"/imgzone/"},{pattern:"s\\d+x\\d+_(.*?)\\/",modifiers:"",replacement:"$1/"},{pattern:"!cc_50x64.jpg$",modifiers:"",replacement:""}]},{enabled:!0,site:"唯品会",srcPattern:"a.vpimg\\d+.com/upload|h\\d.appsimg.com.*/upload",replaceRules:[{pattern:"(_\\d+)*x\\d+(_\\d+)*.jpg",modifiers:"",replacement:".jpg"}]},{enabled:!0,site:"Amazon",srcPattern:"images-na.ssl-images-amazon.com/images|m.media-amazon.com/images",replaceRules:[{pattern:"\\.[^./]+\\.jpg",modifiers:"",replacement:".jpg"},{pattern:"_AC_UL1500_.",modifiers:"",replacement:""}]},{enabled:!0,site:"小红书",srcPattern:"ci.xiaohongshu.com",replaceRules:[{pattern:"\\?imageView2\\/2\\/w\\/100\\/h\\/100\\/q\\/90",modifiers:"",replacement:""}]},{enabled:!0,site:"airbnb",srcPattern:"muscache..+/im/pictures",replaceRules:[{pattern:"\\?aki_policy=.*|\\?tdsourcetag=s_pcqq_aiomsg",modifiers:"",replacement:"?aki_policy=xx_large"}]},{enabled:!0,site:"美工云",srcPattern:"src.meigongyun.com/forum.*\\.jpg-png_gif",replaceRules:[{pattern:"\\.jpg-png_gif",modifiers:"",replacement:".jpg-homeSlide"}]},{enabled:!1,site:"shein.com",srcPattern:"//img.ltwebstatic.com/images2_pi/.*_thumbnail.*\\.jpg",replaceRules:[{pattern:"_thumbnail.*?\\.",modifiers:"",replacement:"."}]},{enabled:!0,site:"易派客 epec.com",srcPattern:"//img.epec.com/.*\\.(jpg|png)",replaceRules:[{pattern:"\\.(jpg|png).\\d+w_\\d+h_.*",modifiers:"",replacement:".$1"}]},{enabled:!0,site:"pailixiang.com",srcPattern:"http://img.pailixiang.com.*@!(pbig|psmall)",replaceRules:[{pattern:".!(pbig|psmall)",modifiers:"",replacement:""}]},{enabled:!0,site:"aikucun",srcPattern:"akmer.aikucun.com/",replaceRules:[{pattern:"\\?x-oss-process.*",modifiers:"",replacement:""}]},{enabled:!0,site:"lookbooks.com",srcPattern:"amazonaws.com.*/lg_|lookbookspro.com.*/lg_",replaceRules:[{pattern:"\\/lg_",modifiers:"",replacement:"/gxl_"}]},{enabled:!0,site:"www.aplusprod.com",srcPattern:"images.squarespace-cdn.com/content/.*?format=\\d+w",replaceRules:[{pattern:"\\?format=\\d+w",modifiers:"",replacement:""}]},{enabled:!0,site:"unsplash.com",srcPattern:"images.unsplash.com/photo-",replaceRules:[{pattern:"&auto=format&.*|&w=\\d+.*",modifiers:"",replacement:""}]},{enabled:!0,site:"m.inmuu.com",srcPattern:"s.tupianzhibo.cn/image/jpeg.*!listpc",replaceRules:[{pattern:"!listpc",modifiers:"",replacement:""}]},{enabled:!0,site:"www.reiss.com",srcPattern:"www.reiss.com/media/product",replaceRules:[{pattern:"\\?format=.*",modifiers:"",replacement:""}]},{enabled:!0,site:"微相册",srcPattern:"xcimg.szwego.com/.*.jpg\\?imageMogr2.*",replaceRules:[{pattern:"\\?imageMogr2.*",modifiers:"",replacement:""}]},{enabled:!0,site:"人人网",srcPattern:"fmn.xnpic.com|fmn.rrfmn.com",replaceRules:[{pattern:"\\p\\/(.*?)_p",modifiers:"",replacement:"p"}]},{enabled:!0,site:"知乎",srcPattern:"pic\\d.zhimg.com",replaceRules:[{pattern:"\\.com\\\\d+\\/",modifiers:"",replacement:".com/"},{pattern:"_hd.",modifiers:"",replacement:"_r."}]},{enabled:!0,site:"堆糖",srcPattern:"c-ssl.dtstatic.com",replaceRules:[{pattern:"\\.thumb\\.\\d+_\\d+_.\\.jpg.*",modifiers:"",replacement:".jpg"}]},{enabled:!0,site:"堆糖",srcPattern:"duitang.com/uploads/item/.*\\.thumb\\.",replaceRules:[{pattern:"\\.thumb.*\\.",modifiers:"",replacement:"."}]},{enabled:!0,site:"POCO",srcPattern:"pocoimg.cn/image/poco",replaceRules:[{pattern:"_W\\d+.jpg",modifiers:"",replacement:".jpg"},{pattern:"\\?imageMogr2.*",modifiers:"",replacement:""}]},{enabled:!0,site:"DHgate",srcPattern:"dhresource.com",replaceRules:[{pattern:"\\/\\d+x\\d+(s?)\\/",modifiers:"",replacement:"/0x0$1/"},{pattern:"webp\\/m\\/",modifiers:"",replacement:""}]},{enabled:!0,site:"yzcdn",srcPattern:"img.yzcdn.cn/upload_files",replaceRules:[{pattern:"!large.webp",modifiers:"",replacement:""}]},{enabled:!0,site:"途家民宿",srcPattern:"pic.tujia.com/upload/.*/thumb/",replaceRules:[{pattern:"_300_200",modifiers:"",replacement:"_1500_1003"}]},{enabled:!0,site:"kidsfootlocker",srcPattern:"images.footlocker.com",replaceRules:[{pattern:"&fmt=png-alpha",modifiers:"",replacement:""},{pattern:"wid=\\d+",modifiers:"",replacement:"wid=640"},{pattern:"hei=\\d+",modifiers:"",replacement:"hei=640"}]},{enabled:!1,site:"美叶 www.meiye.art",srcPattern:"images.psketch.com",replaceRules:[{pattern:"_min_.*",modifiers:"",replacement:""},{pattern:"?imageView2/2/w/500",modifiers:"",replacement:""}]},{enabled:!1,site:"caselio.com",srcPattern:"medias-caselio.e-systemes",replaceRules:[{pattern:"_\\d+\\.jpg$",modifiers:"",replacement:".jpg"}]},{enabled:!1,site:"gallery.vphotos.cn",srcPattern:"img.vphotos.cn",replaceRules:[{pattern:"logothumb",modifiers:"",replacement:"logosmall"}]},{enabled:!1,site:"bp.pep.com.cn",srcPattern:"bp.pep.com.cn/ebook/",replaceRules:[{pattern:"/thumb/",modifiers:"",replacement:"/mobile/"}]},{enabled:!1,site:"www.archdaily.com",srcPattern:"images.adsttc.com",replaceRules:[{pattern:"/thumb_jpg/",modifiers:"",replacement:"/slideshow/"}]},{enabled:!0,site:"洋码头 ymatou.com",srcPattern:"pic\\d+.ymatou.com/",replaceRules:[{pattern:"_i.jpg",modifiers:"",replacement:"_o.jpg"}]},{enabled:!0,site:"站酷",srcPattern:"img.zcool.cn/community",replaceRules:[{pattern:"@.*",modifiers:"",replacement:""}]},{enabled:!1,site:"FURLA",srcPattern:"furla-cdn.thron.cn/delivery/public/image",replaceRules:[{pattern:"\\/std\\/\\d+x\\d+",modifiers:"",replacement:"/std/1000x1000"}]},{enabled:!1,site:"图虫网",srcPattern:"photo.tuchong.com|pstatp.com/weili",replaceRules:[{pattern:"\\/ft\\d+\\/",modifiers:"",replacement:"/f/"},{pattern:"/sm/",modifiers:"",replacement:"/l/"}]},{enabled:!1,site:"Pexels",srcPattern:"images.pexels.com",replaceRules:[{pattern:"\\?.*",modifiers:"",replacement:""}]},{enabled:!0,site:"Youtuge",srcPattern:"i.ytimg.com/",replaceRules:[{pattern:"hqdefault",modifiers:"",replacement:"maxresdefault"}]},{enabled:!0,site:"澳新直邮正品 MOFA",srcPattern:"mfd-storage.cdn.aladdin.nz",replaceRules:[{pattern:"\\?x-oss-process=.*",modifiers:"",replacement:""}]},{enabled:!0,site:"Ekonika",srcPattern:"ekonika.ru/resize/.*/upload",replaceRules:[{pattern:"resize\\/.*\\/upload",modifiers:"",replacement:"upload"}]},{enabled:!0,site:"photoplus | plusx",srcPattern:"s.plusx.cn",replaceRules:[{pattern:"imageView.*?&",modifiers:"",replacement:""}]},{enabled:!0,site:"Apple | 苹果",srcPattern:"store.storeimages.cdn-apple.com",replaceRules:[{pattern:"wid=(76|38)",modifiers:"",replacement:"wid=2000"},{pattern:"hei=(76|38)",modifiers:"",replacement:"hei=2000"}]},{enabled:!0,site:"mario muzi",srcPattern:"www.mariomuzi.com",replaceRules:[{pattern:"_resize_\\d+_\\d+",modifiers:"",replacement:"_resize_free_1000_"}]},{enabled:!0,site:"zalando",srcPattern:"ztat.net",replaceRules:[{pattern:"\\?.*",modifiers:"",replacement:""}]},{enabled:!0,site:"walmart",srcPattern:"walmartimages.com",replaceRules:[{pattern:"\\?.*",modifiers:"",replacement:""}]},{enabled:!0,site:"GAME UI",srcPattern:"image.gameuiux.cn",replaceRules:[{pattern:"\\?.*",modifiers:"",replacement:""}]},{enabled:!0,site:"大作网",srcPattern:"//csimg\\d+.bigurl.ink/jin/",replaceRules:[{pattern:"\\?.*",modifiers:"",replacement:""}]},{enabled:!0,site:"zillow",srcPattern:"photos.zillowstatic.com",replaceRules:[{pattern:"-cc_ft_\\d+|-p_e|-p_h",modifiers:"",replacement:"-uncropped_scaled_within_1344_1008"}]},{enabled:!0,site:"中关村",srcPattern:"zol-img.com.cn",replaceRules:[{pattern:"_\\d+x\\d+",modifiers:"",replacement:""}]},{enabled:!0,site:"rumah123",srcPattern:"picture.rumah123.com",replaceRules:[{pattern:"\\d+x\\d+-fit",modifiers:"",replacement:"2560x2560-fit"}]},{enabled:!0,site:"携程网",srcPattern:"ctrip.com/images/",replaceRules:[{pattern:"_W_.*?\\.",modifiers:"",replacement:"."},{pattern:"_R_.*\\.",modifiers:"",replacement:"."}]},{enabled:!0,site:"携程网评论",srcPattern:"ak-d.tripcdn.com/images",replaceRules:[{pattern:"_R_.*\\.",modifiers:"",replacement:"."}]},{enabled:!0,site:"去哪儿",srcPattern:"tr-osdcp.qunarzz.com",replaceRules:[{pattern:"_r_.*",modifiers:"",replacement:""}]},{enabled:!0,site:"马蜂窝",srcPattern:"q.mafengwo.net",replaceRules:[{pattern:"\\?imageView.*",modifiers:"",replacement:""}]},{enabled:!0,site:"qifa.ru",srcPattern:"images\\.qifa\\.",replaceRules:[{pattern:".JPG_\\d+x\\d+",modifiers:"",replacement:".JPG_1000x1000"}]},{enabled:!0,site:"哔哩哔哩",srcPattern:"https://i0.hdslb.com/bfs/",replaceRules:[{pattern:".jpg.*",modifiers:"",replacement:".jpg"},{pattern:".png.*",modifiers:"",replacement:".png"}]},{enabled:!0,site:"HOGO",srcPattern:".dlssyht.cn",replaceRules:[{pattern:"\\?.*",modifiers:"",replacement:""}]},{enabled:!0,site:"ETSY",srcPattern:"i.etsystatic.com|www.etsy.com/img",replaceRules:[{pattern:"il_\\d+x\\d+",modifiers:"",replacement:"il_NxN"}]},{enabled:!0,site:"蝉妈妈",srcPattern:"cdn-images.chanmama.com",replaceRules:[{pattern:"\\?.*",modifiers:"",replacement:""}]},{enabled:!0,site:"17zwd",srcPattern:"17zwd.com",replaceRules:[{pattern:"_\\d+-\\d+\\.jpg",modifiers:"",replacement:""}]},{enabled:!0,site:"karl",srcPattern:"www.karl.com",replaceRules:[{pattern:"\\?.*",modifiers:"",replacement:""}]},{enabled:!0,site:"得物",srcPattern:"image-cdn.poizon.com",replaceRules:[{pattern:"\\?.*",modifiers:"",replacement:""}]},{enabled:!0,site:"ebay",srcPattern:"i.ebayimg.com/images",replaceRules:[{pattern:"s-l\\d+",modifiers:"",replacement:"s-l1600"}]},{enabled:!0,site:"ytrs",srcPattern:"ytrs.tk",replaceRules:[{pattern:"size=%22sm%22",modifiers:"",replacement:"size=%22xl%22"}]},{enabled:!0,site:"拼多多评论",srcPattern:"review.pddpic.com",replaceRules:[{pattern:"\\?.*",modifiers:"",replacement:""}]}],u=function(){return{parse:function(e){if(e.match(/^data/))return e;for(let a=0;a<c.length;a++){const t=c[a];if(t.enabled){const r=new RegExp(t.srcPattern);if(t.replaceRules&&r.test(e)){let n=e;try{t.replaceRules.forEach(s=>{n=n.replace(new RegExp(s.pattern,s.modifiers),s.replacement)});const i=c.splice(a,1)[0];return c.unshift(i),n}catch{}}}}return""}}}();function o(e){var a=e.match("://(.*?)/");return a?a[1]:""}function g(e,a){var t=new XMLHttpRequest;t.responseType="blob",t.onload=function(){var r=t.getResponseHeader("Content-Type")||"image/jpeg";r=r.split(";")[0].split(",")[0].split("/")[1];var n=window.URL.createObjectURL(t.response);a({success:!0,data:{blobUrl:n,contentType:r}})},t.onerror=function(){a({success:!1,msg:"xhr error"})};try{t.open("GET",e,!0),t.send()}catch{a({success:!1,msg:"Invalid uri"})}}function f(e,a){let t=new OffscreenCanvas(e.naturalWidth,e.naturalHeight);t.getContext("2d").drawImage(e,0,0);var r=a.split("."),n=r[r.length-1].toLowerCase();return n.replace(/[?#].*/,""),{jpgPngDataUrl:t.toDataURL("image/jpeg"),ext:"jpg"}}async function b(e,a){let t=new OffscreenCanvas(e.naturalWidth,e.naturalHeight);t.getContext("2d").drawImage(e,0,0);var r=a.split("."),n=r[r.length-1].toLowerCase();n.replace(/[?#].*/,"");var i="";let s="";n=="jpg"||n=="jpeg"?(s="image/jpeg",i="jpg"):(s="image/png",i="png");let p=await t.convertToBlob({type:s});return{jpgPngBlobUrl:URL.createObjectURL(p),ext:i}}function h(e,a){var t=e.contentType;t&&(t=t.split(";")[0]);var r=new Image,n={};r.onload=async function(){if(n.ext=t=="octet-stream"?"":t,n.width=r.naturalWidth,n.height=r.naturalHeight,l.autoConvertWebp&&t=="webp"){var i=await b(r,e.bigUrl);n.jpgPngDataUrl=i.jpgPngBlobUrl,n.ext=i.ext||n.ext}a({success:!0,data:n})},r.src=e.blobUrl}function w(e,a){e.contentType?h(e,function(t){for(var r in t.data)e[r]=t.data[r];a(t)}):a({success:!1,msg:"Content-Type-Error"})}function m(e,a){var t=new Image;t.onload=function(){if(e.width=t.naturalWidth,e.height=t.naturalHeight,l.autoConvertWebp&&e.ext=="webp"){var r=f(t,e.bigUrl);e.jpgPngDataUrl=r.jpgPngDataUrl,e.ext=r.ext||e.ext}a({success:!0})},t.src=e.bigUrl}function R(e,a,t){try{e.bigUrl.match("^data:image")}catch{}e.bigUrl.match("^data:image")?(e.ext=e.bigUrl.match("^data:image/(.+?);")[1],m(e,t)):l.autoConvertWebp||l.needBlobDomains.indexOf(e.site)>=0?g(e.bigUrl,function(r){r.success?(e.blobUrl=r.data.blobUrl,e.contentType=r.data.contentType,w(e,function(n){l.needBlobDomains.indexOf(e.site)==-1&&(window.URL.revokeObjectURL(e.blobUrl),delete e.blobUrl),t(n)})):t(r)}):m(e,t)}function P(e,a,t){try{e.bigUrl.match("^data:image")}catch{}e.bigUrl.match("^data:image")?(e.ext=e.bigUrl.match("^data:image/(.+?);")[1],m(e,t)):chrome.tabs.sendMessage(a.id,{cmd:"GET_BLOB",url:e.bigUrl},{frameId:e.frameId},function(r){r.success?(e.blobUrl=r.data.blobUrl,e.contentType=r.data.contentType,chrome.tabs.sendMessage(a.id,{cmd:"GET_INFO_FROM_BLOB",item:e},function(n){if(n){for(var i in n.data)e[i]=n.data[i];l.needBlobDomains.indexOf(e.site)==-1&&(window.URL.revokeObjectURL(e.blobUrl),delete e.blobUrl)}t(n)})):t(r)})}function d(e,a,t,r){this.originalUrl=e.src,this.type=r,this.tabIndex=a.index,this.tabId=a.id,this.frameId=t,this.ref=a.url,this.site=o(a.url),this.docTitle=e.docTitle||window.ftk_docTitle||a.title,this.group_en=e.group_en}function _(e,a,t){d.call(this,e,a,t,"IMG"),this.alt=e.alt}function x(e,a,t,r,n,i){if(e.src){typeof r=="function"&&(n=r,r=0);var s=this;this.index=a,_.call(this,e,t,r),this.bigUrlIsValid=!0,this.bigUrl=u.parse(this.originalUrl),this.smallUrl=e.smallUrl||this.bigUrl,this.group=e.group||"",this.groupIndex=e.groupIndex===void 0?-1:e.groupIndex,e.width&&e.height?(this.width=e.width,this.height=e.height,n(this)):chrome.tabs&&l.needBlobDomains.indexOf(o(t.url))>=0?P(this,t,function(p){p.success||(s.bigUrlIsValid=!1),n(s)}):R(this,t,function(p){p.success||(s.bigUrlIsValid=!1),n(s)})}else i&&i()}function j(e,a,t,r,n){typeof r=="function"&&(n=r,r=0),d.call(this,e,t,r,"VIDEO"),this.group=e.group||"",this.groupIndex=e.groupIndex===void 0?-1:e.groupIndex,this.index=a,this.width=0,this.height=0,this.alt=e.alt,n(this)}export{x as P,j as V,l as a,u as b};
