const g={rename(i){return i.replace(/[`~!@#$%^&*()|+=?;:'",.<>{}[\]]/gi,"-").replace(/[\\/]/gi,"_")},guess(i,n,s=!0){const o={},{disposition:a,type:p,src:l,page:c,size:u}=i;let e=i.name||"";if(!e&&a){const t=/filename\*=UTF-8''([^;]*)/.exec(a);t&&t.length&&(e=t[1].replace(/["']$/,"").replace(/^["']/,""),e=decodeURIComponent(e))}if(!e&&a){const t=/filename=([^;]*)/.exec(a);t&&t.length&&(e=t[1].replace(/["']$/,"").replace(/^["']/,""))}if(!e&&c)for(const t of["jpeg","jpg","png","gif","bmp","webp"]){const r=c.toLowerCase().indexOf("."+t);if(r!==-1&&u>512e3){e=c.slice(0,r).split("/").pop();break}}if(!e)if(l.startsWith("http")){const t=l.replace(/\/$/,""),r=/(title|filename)=([^&]+)/.exec(t);r&&r.length?e=r[2]:e=t.substring(t.lastIndexOf("/")+1);try{e=decodeURIComponent(e.split("?")[0].split("&")[0])||"image"}catch{}}else e="image";if(a&&e){const t=[...e].map(r=>r.charCodeAt(0)).filter(r=>r<=255);e=new TextDecoder("UTF-8").decode(Uint8Array.from(t))}e.indexOf(".")===-1&&p&&p!=="image/unknown"&&(e+="."+p.split("/").pop().split(/[+;]/).shift());let m=e.lastIndexOf(".");m===-1&&(m=e.length);let d=e.slice(m).slice(0,10);d.length==0&&s&&(d=".jpg"),e=e.slice(0,m),e.startsWith("%")&&(e=decodeURIComponent(e)),e in o?o[e]+=1:o[e]=1;let f=n||"[name][extension]";return f=f.split("[extension]").map(t=>(t=t.replace(/\[name\]/gi,e+(o[e]===1?"":"-"+o[e])).replace(/\[type\]/gi,p||"").replace(/\[disposition\]/gi,a||"").replace(/\[alt\]/gi,i.alt||"").replace(/\[order\]/gi,"__ORDER__").replace(/\[index\]/gi,o[e]).replace(/\[custom=[^\]]+\]/gi,i.custom),t=g.rename(t),t=t.slice(0,60),t)).join(d),{filename:f,name:e}},size(i){const n=Number(i.headers.get("content-length"));if(n&&isNaN(n)===!1)return n;if(i.url&&i.url.startsWith("data:")){const[s,...o]=i.url.split(","),a=o.join(",");if(s&&s.indexOf("base64")!==-1)try{return atob(a).length}catch{}if(s)return a.length}return 0},type(i={},n){return n.type&&n.type.startsWith("text/")?n.type:i.type||n.type||""}};{const i=(n,s="default-timeout")=>new Promise((o,a)=>{chrome.storage.local.get({[s]:3e4},p=>{const l=new AbortController;setTimeout(()=>l.abort(),p[s]),fetch(n,{signal:l.signal}).then(c=>{if(c.ok)o({response:c,controller:l});else throw Error("STATUS_CODE_"+c.status)}).catch(a)})});i.text=n=>i(n,"dig-timeout").then(({response:s})=>s.text()).catch(()=>""),i.segment=n=>i(n,"head-timeout").then(async s=>{const o=(await s.response.body.getReader().read()).value;return setTimeout(()=>s.controller.abort()),{ok:!0,type:s.response.headers.get("content-type")||"",size:g.size(s.response),disposition:s.response.headers.get("content-disposition")||"",segment:o}}),i.heads=n=>i(n,"head-timeout").then(s=>(setTimeout(()=>s.controller.abort()),{ok:!0,type:s.response.headers.get("content-type")||"",size:g.size(s.response),disposition:s.response.headers.get("content-disposition")||""})).catch(()=>({})),g.response=i}g.EXTENSIONS={css:"text/css",html:"text/html",js:"text/javascript",flv:"video/flv",mp4:"video/mp4",m3u8:"application/x-mpegURL",ts:"video/MP2T","3gp":"video/3gpp",mov:"video/quicktime",avi:"video/x-msvideo",wmv:"video/x-ms-wmv",m4a:"audio/mp4",mp3:"audio/mpeg",ogg:"audio/x-mpegurl",wav:"audio/vnd.wav",png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",cur:"image/cur",gif:"image/gif",ico:"image/ico",icns:"image/icns",psd:"image/psd",svg:"image/svg",tiff:"image/tiff",webp:"image/webp"};export{g as u};
