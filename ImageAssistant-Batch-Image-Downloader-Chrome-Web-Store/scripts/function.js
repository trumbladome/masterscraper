/**
 * ImageAssistant
 * Project Home: http://www.pullywood.com/ImageAssistant/
 * Author: Joey
 * Copyright (C) 2013-2024 普利坞(Pullywood.com)
**/
"use strict";if(typeof global==="undefined"){if(typeof window!=="undefined"){window.global=window}else{globalThis.global=globalThis}}global.storage={async set(key,value){return await new Promise(((resolve,reject)=>{chrome.storage.local.set({[key]:value},(result=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve()}}))}))},async get(key){return await new Promise(((resolve,reject)=>{chrome.storage.local.get(key,(result=>{if(chrome.runtime.lastError){reject(chrome.runtime.lastError)}else{resolve(result[key])}}))}))}};global._o_numberSeed="0123456789";global._o_hexSeed="0123456789abcdef";global._o_charSeed="0123456789abcdefghijklmnopqrstuvwxyz";global._o_ajax_request_timeout=8e3;global._w_rout="https://www.pullywood.com/ImageAssistant/blank.html";global._o_extStatisticURL="https://www.pullywood.com/ImageAssistant/images/IAnalytic.png";global._o_resourceListURL="https://www.pullywood.com/publish/imageassistant-resource-list";global._o_multiURLExtDefURL=_w_rout;global._o_SSL_multiURLExtDefURL=_w_rout;global._o_remoteRuleURL="https://www.pullywood.com/ImageAssistant/defaultRegexpUrlRule.properties";global._o_dynamicConfigURL="https://www.pullywood.com/ImageAssistant/dynamic_config.json";global._w_anthem="https://www.pullywood.com/ImageAssistant/version.json";global._o_background_ajax_seted=false;global._o_background_ajax_hash_mapper={};global._w_groove=false;global._o_preRenderSize=512;global._o_atomPngSrc="./images/loading.gif";async function _w_trunk(){global._o_multiURLExtDefURL=await _o_urlAddFinger(global._w_rout);global._o_SSL_multiURLExtDefURL=await _o_urlAddFinger(global._w_rout);global._o_remoteRuleURL=await _o_urlAddFinger(global._o_remoteRuleURL);global._o_dynamicConfigURL=await _o_urlAddFinger(global._o_dynamicConfigURL);global._w_anthem=await _o_urlAddFinger(global._w_anthem)}_w_trunk();global._w_hinge={_w_streak:[`${_MSG_("manifest_ext_name")}/{page.title}`,`${_MSG_("manifest_ext_name")}/{page.host}/{page.title}`,`${_MSG_("manifest_ext_name")}/{YYYY-MM-DD}/{page.title}`,`${_MSG_("manifest_ext_name")}/{page.host}/{YYYY-MM-DD}_{HH-mm-ss}/{page.title}`],_w_gander:["{filename}","{no.10001}","{origin_serial}"]};global._o_Base64={_keyStr:"bFf2YMpEZLT6OBqN/DCtJlnc9G154W=wP+h3Rrk8xadIzjQoHmv7sAS0yeUiKVugX",encode:function(e){let t="";let n,r,i,s,o,u,a;let f=0;e=_o_Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){let t="";let n,r,i;let s,o,u,a;let f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=_o_Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");let t="";for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){let t="";let n=0;let r=0,c1=0,c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);var c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}};if(!Object.entries){Object.entries=function(obj){var ownProps=Object.keys(obj),i=ownProps.length,resArray=new Array(i);while(i--){resArray[i]=[ownProps[i],obj[ownProps[i]]]}return resArray}}if(!Object.values){Object.values=function(obj){return Object.keys(obj).map((function(key){return obj[key]}))}}if(!String.prototype.endsWith){String.prototype.endsWith=function(searchString,position){let _w_subjectString=this.toString();if(typeof position!=="number"||!isFinite(position)||Math.floor(position)!==position||position>_w_subjectString.length){position=_w_subjectString.length}position-=searchString.length;let _w_lastIndex=_w_subjectString.indexOf(searchString,position);return _w_lastIndex!==-1&&_w_lastIndex===position}}if(!String.prototype.startsWith){String.prototype.startsWith=function(searchString,position){position=position||0;return this.indexOf(searchString,position)===position}}if(!Number.parseInt)Number.parseInt=parseInt;if(!(typeof window==="undefined")&&!window.URL){window.URL=function(url){if(url.indexOf("://")<0)throw new TypeError("Invalid URL");this.url=url;this.link=document.createElement("a");this.link.href=url;this.href=this.link.href;this.protocol=this.link.protocol;this.host=this.link.host;this.hostname=this.link.hostname;this.port=this.link.port;this.pathname=this.link.pathname;this.search=this.link.search;this.hash=this.link.hash;this.username=this.link.username;this.password=this.link.password;this.origin=this.link.origin}}global._o_uri_regexp=/(['"\s\n\r])(data:image\/[a-zA-Z0-9+\/]+;base64,[a-zA-Z0-9+/=]+|[^'"\s\n\r]*?\.(apng|bmp|gif|ico|cur|jpg|jpeg|jfif|pjpeg|pjp|png|svg|tif|tiff|webp|pnj)(\?[^'"\s\n\r]*)?)(?=['"\s\n\r])/gi;global._o_items_fun=function(_o_items){let _o_content_src_list=[];_o_items&&_o_items.forEach((function(item){let _w_src=item.replace(/[\\'"\s\n\r]+/gi,"");_o_content_src_list.push(_w_src)}));return _o_content_src_list};if(!(typeof $==="undefined")){$.ajaxSetup({timeout:_o_ajax_request_timeout,headers:{Accept:"*/*; charset=UTF-8","Cache-Control":"no-cache, no-store, must-revalidate, max-age=0, post-check=0, pre-check=0",Pragma:"no-cache",Expires:"0"}})}if(!(typeof jQuery==="undefined")){(function($){let _w_xhrPool=[];$(document).ajaxSend((function(e,jqXHR,options){_w_xhrPool.push(jqXHR)}));$(document).ajaxComplete((function(e,jqXHR,options){_w_xhrPool=$.grep(_w_xhrPool,(function(x){return x!=jqXHR}))}));let _w_abort=function(){$.each(_w_xhrPool,(function(idx,jqXHR){jqXHR.abort()}))};let _w_oldBeforeUnLoad=window.onbeforeunload;window.abortAjaxRequest=function(){_w_abort()};window.onbeforeunload=function(){let _w_r=_w_oldBeforeUnLoad?_w_oldBeforeUnLoad():undefined;if(_w_r==undefined){_w_abort()}return _w_r}})(jQuery)}function _w_slab(blob){return new Promise(((resolve,reject)=>{const reader=new FileReader;reader.onloadend=function(){const arr=new Uint8Array(reader.result).subarray(0,256);let header="";for(let i=0;i<arr.length;i++){header+=arr[i].toString(16).padStart(2,"0")}const textHeader=(new TextDecoder).decode(arr);let _w_fury="unknown";const riffHeader=header.slice(0,8);const riffType=header.slice(16,24);switch(true){case header.startsWith("89504e470d0a1a0a"):_w_fury="png";break;case header.startsWith("424d"):_w_fury="bmp";break;case header.startsWith("47494638"):_w_fury="gif";break;case header.startsWith("00000100"):case header.startsWith("00000200"):_w_fury="ico";break;case header.startsWith("ffd8ff"):_w_fury="jpeg";break;case header.startsWith("49492a00"):case header.startsWith("4d4d002a"):_w_fury="tiff";break;case riffHeader==="52494646"&&riffType==="57454250":_w_fury="webp";break;default:if(textHeader.includes("<svg")){_w_fury="svg"}break}resolve(_w_fury)};reader.onerror=function(){reject("Failed to read the blob")};reader.readAsArrayBuffer(blob)}))}function awaitWithTimeout(promise,defaultData=null,timeout=2e3){if(promise instanceof async function(){}.constructor){promise=promise()}return new Promise(((resolve,reject)=>{const timeoutHandle=setTimeout((()=>{resolve(defaultData)}),timeout);promise.then((response=>{clearTimeout(timeoutHandle);resolve(response)})).catch((e=>{clearTimeout(timeoutHandle);reject(e)}))}))}async function _o_selectExtractor(_o_extractorHash){try{const _w_patch=await chrome.runtime.sendMessage(_o_getExtensionId(),{type:"_o_selectExtractor",extractorHash:_o_extractorHash});if(_w_patch)return _w_patch.value;return null}catch(e){return null}}async function _o_urlAddFinger(url){if(typeof url!="string")return url;if(url.indexOf("&finger=")>0)return url;let _w_clientFinger=await _o_randomFingerChar();let _w_parameter="version=".concat(chrome.runtime.getManifest().version).concat("&finger=").concat(_w_clientFinger);if(url.indexOf("?")>=0){return url.concat("&").concat(_w_parameter)}else{return url.concat("?").concat(_w_parameter)}}function _o_urlProtocolFollowPage(url){let _w_regexPattern=/^https?:(\/\/.*?)$/;let _w_pageUrlMatcher=window.location.href?window.location.href.match(_w_regexPattern):null;let _w_inputUrlMatcher=url?url.match(_w_regexPattern):null;if(_w_pageUrlMatcher&&_w_inputUrlMatcher){return _w_inputUrlMatcher[1]}return url}function _o_isFunction(taskFun){return taskFun&&typeof taskFun==="function"}function _o_isTargetInput(e){if(e.target&&["INPUT","TEXTAREA"].indexOf(e.target.tagName)>=0||e.target.contentEditable=="true")return true;return false}function _o_createTaskExecutePool(_w_maxConCurrent){let _w_task_list=[];let _w_task_processing=0;let _w_task_pre_processing=0;let _w_task_max=_w_maxConCurrent;setInterval((async function fetchAndExecTask(){if(_w_task_processing<_w_task_max&&_w_task_pre_processing<_w_task_max&&_w_task_list.length>0){_w_task_pre_processing++;let _w_taskFun=_w_task_list.shift();if(_o_isFunction(_w_taskFun)){await _w_taskFun((function(){_w_task_processing++}),(function(){_w_task_processing--}),(function(){return[_w_task_processing,_w_task_list.length]}))}_w_task_pre_processing--}}),10);return{setMax:function(max){_w_task_max=max},getProcessingNum:function(){return _w_task_processing},getTaskNum:function(){return _w_task_list.length},addTaskToLast:function(taskFun){_w_task_list.push(taskFun)},addTaskToFirst:function(taskFun){_w_task_list.unshift(taskFun)},addTask:function(taskFun){_w_task_list.push(taskFun)}}}function _o_hexToRgb(hex){let _w_shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(_w_shorthandRegex,(function(m,r,g,b){return r+r+g+g+b+b}));let _w_result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return _w_result?{r:parseInt(_w_result[1],16),g:parseInt(_w_result[2],16),b:parseInt(_w_result[3],16)}:null}function _o_showDefaultFolder(){chrome.downloads.showDefaultFolder()}function _o_blockImageLoad(){if(_o_blockImageLoadObserverInited){return}else{let _o_blockImageLoadObserverInited=true}new MutationObserver((function(_w_mutations){_w_mutations.forEach((function(_w_mutation){for(let i=0;i<_w_mutation.addedNodes.length;++i){let _w_addedNode=_w_mutation.addedNodes.item(i);if(_w_addedNode.tagName=="IMG"){_w_addedNode.removeAttribute("src")}else if(typeof _w_addedNode.getElementsByTagName!=="function"){return}else{let _w_imgs=_w_addedNode.getElementsByTagName("img");for(let j=0;j<_w_imgs.length;++j)_w_imgs[j].removeAttribute("src")}}}))})).observe(document.body,{childList:true,subtree:true})}function _MSG_(key){return chrome.i18n.getMessage(key)}function _o_decodeUrl(url){url||(url="");try{url=decodeURIComponent(url)}catch(e){}return url}async function _o_executeFunWhenTabNotPending(_w_tabId,_w_func){await async function observeStatus(){setTimeout((async()=>{let _w_observedtab=null;try{_w_observedtab=await chrome.tabs.get(_w_tabId)}catch(e){}if(!_w_observedtab){_o_isFunction(_w_func)&&await _w_func(_w_observedtab);return}if(_w_observedtab||!_w_observedtab.pendingUrl){_o_isFunction(_w_func)&&await _w_func(_w_observedtab)}else{observeStatus()}}),250)}()}function _o_executeFunWhenTabComplete(_w_tabId,_w_func){(function observeStatus(){setTimeout((async()=>{let _w_observedtab=null;try{_w_observedtab=await chrome.tabs.get(_w_tabId)}catch(e){}if(!_w_observedtab){return}if(_w_observedtab&&_w_observedtab.status&&_w_observedtab.status=="complete"){_o_isFunction(_w_func)&&_w_func(_w_observedtab)}else{observeStatus()}}),250)})()}function _w_stern(_o_tabId,_o_callback){(function observeStatus(){setTimeout((()=>{chrome.tabs.remove(_o_tabId,(function(){if(chrome.runtime.lastError){if(chrome.runtime.lastError.message.indexOf("drag")>0){observeStatus()}else{return}}else if(_o_isFunction(_o_callback)){_o_callback.apply(this,arguments)}}))}),250)})()}function _o_getQueryString(_w_name){if(location.href.indexOf("?")==-1||location.href.indexOf(_w_name+"=")==-1){return""}let _w_queryString=location.href.substring(location.href.indexOf("?")+1);if(_w_queryString.indexOf("#")>-1){_w_queryString=_w_queryString.substring(0,_w_queryString.indexOf("#"))}let _w_parameters=_w_queryString.split("&");let _w_pos,paraName,paraValue;for(let i=0;i<_w_parameters.length;i++){_w_pos=_w_parameters[i].indexOf("=");if(_w_pos==-1){continue}paraName=_w_parameters[i].substring(0,_w_pos);paraValue=_w_parameters[i].substring(_w_pos+1);if(paraName==_w_name){return unescape(paraValue.replace(/\+/g," "))}}return""}function _o_extracHostname(url){let _w_matches=url.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i);if(_w_matches){return _w_matches[1]}return""}function _w_silt(url){let _w_matches=url.match(/^(https?\:\/\/[^\/?#]+\/)/i);if(_w_matches){return _w_matches[1]}return""}function _o_extractUrlWithoutHash(url){if(typeof url=="string"){return url.replace(/#.*$/gi,"")}return null}function _o_getURLPath(url=window.location.href){try{const _w_url=new URL(url);return _w_url.origin+_w_url.pathname}catch(error){console.error(`Invalid URL: ${url}, ${error}`);return null}}function _w_adage(url=window.location.href){try{const _w_url=new URL(url);return _w_url.search}catch(error){console.error(`Invalid URL: ${url}, ${error}`);return null}}function _o_canculateImageSize(_w_img,_w_maxWidth,_w_maxHeight){let _w_rect={width:0,height:0};if(_w_img&&_w_maxWidth&&_w_maxHeight){try{let _w_width=_w_img.width;let _w_height=_w_img.height;if(_w_width<=_w_maxWidth&&_w_height<=_w_maxHeight){_w_rect.width=_w_width;_w_rect.height=_w_height}else if(_w_width/_w_height>=_w_maxWidth/_w_maxHeight){_w_rect.width=_w_maxWidth;_w_rect.height=_w_maxWidth/_w_width*_w_height}else{_w_rect.width=_w_maxHeight/_w_height*_w_width;_w_rect.height=_w_maxHeight}}catch(e){}}return _w_rect}async function _w_dent(_o_img,resolutionLimit={maxWidth:256,maxHeight:256}){let rect=_o_canculateImageSize(_o_img,resolutionLimit.maxWidth,resolutionLimit.maxHeight);let canvas=document.createElement("canvas");canvas.width=rect.width;canvas.height=rect.height;canvas.title=_o_img.title;let ctx=canvas.getContext("2d");ctx.drawImage(_o_img,0,0,rect.width,rect.height);const blob=await new Promise((resolve=>canvas.toBlob(resolve,"png")));const tmpUrl=URL.createObjectURL(blob);let blobSrc=await asyncUrlToBlobUrl(tmpUrl);URL.revokeObjectURL(tmpUrl);canvas=null;return blobSrc}function _o_isVisible(_w_domElem){if(!_w_domElem.getBoundingClientRect)return false;let _w_rect=_w_domElem.getBoundingClientRect();if(_w_rect.bottom<0-_o_preRenderSize||_w_rect.right<0-_o_preRenderSize||_w_rect.top>window.innerHeight+_o_preRenderSize||_w_rect.left>window.innerWidth+_o_preRenderSize){return false}else{return true}}if(!(typeof window==="undefined")){window.loadParam={timeout:512,lastExeTime:new Date,timer:null,updateStatics:false,delayAgain:false}}function _o_getExtensionId(){return chrome.runtime.id}function _w_pestle(){return localStorage["drag_download_switch"]=="on"}async function _o_dynamicRender(_w_selector,_w_updateStatics,_w_tempDelay){_w_updateStatics&&(loadParam.updateStatics=_w_updateStatics);_o_throttle(loadParam,(async function(){let _w_updateStatics=false;loadParam.updateStatics&&(_w_updateStatics=loadParam.updateStatics,loadParam.updateStatics=false);if(_w_updateStatics){let _w_menuStatus=(await chrome.runtime.sendMessage({type:"readSetting",key:"_w_parka"})).value;if(_w_menuStatus&1){$("#filter_switch").addClass("btn-pwd active");$("#filter_menu").slideDown("fast",_o_updateHeaderShadowHeight)}else{$("#filter_switch").removeClass("btn-pwd active");$("#filter_menu").slideUp("fast",_o_updateHeaderShadowHeight)}if(_w_menuStatus&2){$("#select_menu_switch").addClass("btn-pwd active");$("#select_menu").slideDown("fast",_o_updateHeaderShadowHeight)}else{$("#select_menu_switch").removeClass("btn-pwd active");$("#select_menu").slideUp("fast",_o_updateHeaderShadowHeight)}const $sortBtn=$("#sort_switch");if(_w_menuStatus&4&&$sortBtn.is(":not(.active)")){$sortBtn.addClass("btn-pwd active");$sortBtn.trigger("funExec")}else if(!(_w_menuStatus&4)&&$sortBtn.is(".active")){$sortBtn.removeClass("btn-pwd active");$sortBtn.trigger("funExec")}if(_w_menuStatus&8){$("#resolutionTle_switch").addClass("btn-pwd active");$(".imageItemResolution").show()}else{$("#resolutionTle_switch").removeClass("btn-pwd active");$(".imageItemResolution").hide()}const $dedupBtn=$("#imageDeduplication_switch");if(_w_menuStatus&16&&$dedupBtn.is(":not(.active)")){$dedupBtn.addClass("btn-pwd active");$("#dedup_menu").show();$dedupBtn.trigger("funExec")}else if(!(_w_menuStatus&16)&&$dedupBtn.is(".active")){$dedupBtn.removeClass("btn-pwd active");$("#dedup_menu").hide()}if((_w_menuStatus|12)==12){$("#menu").hide()}else{$("#menu").show()}let _w_selectedImageType=new Array;let _w_unSelectImageType=new Array;$("#filter_menu_type .imageType[value!=all][value!=other].active").each((function(){_w_selectedImageType.push($(this).attr("value"))}));$("#filter_menu_type .imageType[value!=all][value!=other]:not(.active)").each((function(){_w_unSelectImageType.push($(this).attr("value"))}));$("#filter_menu_type .imageType[value=all]").hasClass("active")?$(_w_selector).show():$("#filter_menu_type .imageType[value=other]").hasClass("active")?$(_w_selector).each((function(){_w_unSelectImageType.indexOf($(this).attr("data-type"))>-1?$(this).hide():$(this).show()})):$(_w_selector).each((function(){_w_selectedImageType.indexOf($(this).attr("data-type"))>-1?$(this).show():$(this).hide()}));let _w_filter_type=_o_filter_image_type.slice(0);_w_filter_type.push("other");$("#counter_all").html($(_w_selector).length);for(let i=0;i<_w_filter_type.length;++i){let _w_count=$(_w_selector+"[data-type="+_w_filter_type[i]+"]").length;$("#counter_"+_w_filter_type[i]).html(_w_count);_w_count!=0?$("#counter_"+_w_filter_type[i]).parent().show():$("#counter_"+_w_filter_type[i]).parent().hide()}if($("#filter_menu_size .selectType[value=larger]").hasClass("active")){$("#filter_menu_size .selectOption[value!=all]").each((function(){$(_w_selector+"[data-max-range="+$(this).attr("value")+"]").length>0?$(this).show():$(this).hide()}));if($("#filter_menu_size .selectOption[value=all]").hasClass("active")){}else if($("#filter_menu_size .selectOption[value=other].active").length>0){$(_w_selector+":visible[data-max-range!=other]").hide()}else{let _w_item=$("#filter_menu_size .selectOption[value!=all][value!=other].active");let _o_image_size=_o_sizeItemExt((await chrome.runtime.sendMessage({type:"readSetting",key:"_w_sap"})).value);let _w_sizeItem=_o_image_size[_w_item.attr("value")];$(_w_selector+":visible").each((function(){$(this).attr("data-width")-_w_sizeItem.width>=0&&$(this).attr("data-height")-_w_sizeItem.height>=0?$(this).show():$(this).hide()}))}}else if($("#filter_menu_size .selectType[value=exact]").hasClass("active")){let _w_selectAbleAmount=0;$("#filter_menu_size .selectOption[value!=all][value!=other]").each((function(){let _w_optionAmount=$(_w_selector+"[data-resolution="+$(this).attr("value")+"]").length;_w_optionAmount>0?$(this).show():$(this).hide();_w_selectAbleAmount+=_w_optionAmount}));let $_w_otherOption=$("#filter_menu_size .selectOption[value=other]");_w_selectAbleAmount<$(_w_selector).length?$_w_otherOption.show():$_w_otherOption.hide();let _w_selectedImageSize=new Array;let _w_unSelectImageSize=new Array;$("#filter_menu_size .selectOption[value!=all][value!=other].active").each((function(){_w_selectedImageSize.push($(this).attr("value"))}));$("#filter_menu_size .selectOption[value!=all][value!=other]:not(.active)").each((function(){_w_unSelectImageSize.push($(this).attr("value"))}));$("#filter_menu_size .selectOption[value=all]").hasClass("active")?true:$("#filter_menu_size .selectOption[value=other]").hasClass("active")?$(_w_selector+":visible").each((function(){_w_unSelectImageSize.indexOf($(this).attr("data-resolution"))>-1?$(this).hide():$(this).show()})):$(_w_selector+":visible").each((function(){_w_selectedImageSize.indexOf($(this).attr("data-resolution"))>-1?$(this).show():$(this).hide()}))}else{}let _w_regexpStr=$("#urlRegexpFilter").prop("value").trim();if(_w_regexpStr&&_w_regexpStr.length>0){try{let _w_matcher=new RegExp(_w_regexpStr);$(_w_selector+":visible").each((function(){if(null!=_w_matcher.exec($(this).attr("data-src"))){$(this).show()}else{$(this).hide()}}));$("#urlRegexpFilter").removeClass("regexp_error")}catch(exception){$("#urlRegexpFilter").addClass("regexp_error")}}else{$("#urlRegexpFilter").removeClass("regexp_error")}$(_w_selector+":visible").addClass("colorbox cboxElement");$(_w_selector+":hidden").removeClass("colorbox cboxElement")}let _w_visibleImageItemLength=$(_w_selector+":visible").length;let _o_dyLoadSize=(await chrome.runtime.sendMessage({type:"readSetting",key:"_o_dyLoadSize"})).value;$(_w_selector).each((function(){let _w_thisElem=$(this).get(0);if(!_o_isVisible(_w_thisElem)){if(_w_visibleImageItemLength<=_o_dyLoadSize)return;let _w_img=$(this).find("img").get(0);_w_img&&_w_img.src!=_o_atomPngSrc&&(_w_img.src=_o_atomPngSrc)}else if($(this).is(":visible")){let _w_img=$(this).find("img").get(0);if(_w_pestle()){_w_img&&_w_img.src!=_w_img.parentNode.href&&(_w_img.src=_w_img.parentNode.href)}else{_w_img&&_w_img.src!=_w_img.dataset.src&&(_w_img.src=_w_img.dataset.src)}}else{$(this).removeClass("selected")}}))}),_w_tempDelay);if(_w_updateStatics){$("#image_amount").html(_o_numberToFixedLengthStr($(_w_selector).length,6));$("#visible_amount").html(_o_numberToFixedLengthStr($(_w_selector+":visible").length,4));$("#select_amount").html(_o_numberToFixedLengthStr($(_w_selector+":visible.selected").length,4));if($("#ext_main>.imageItem").length>0){$("#empty").remove();let _o_loadedMark=true}else if(_o_loadedMark){$("#empty").length>0?true:function(){$("<img />",{id:"empty",src:"./images/empty.svg"}).appendTo($("#ext_main"))}()}_o_updateHeaderShadowHeight();let $_w_ext_main=$("#ext_main");let _w_minOuterHeight=window.innerHeight-$("#header").outerHeight();if($_w_ext_main.outerHeight()<_w_minOuterHeight){let _w_difference=$_w_ext_main.outerHeight()-$_w_ext_main.height();$_w_ext_main.css("min-height",_w_minOuterHeight-_w_difference)}}}function _o_updateHeaderShadowHeight(){$("#ext_main").css("margin-top",$("#header").height())}if(!(typeof window==="undefined")){window.sortParam={timeout:512,lastExeTime:new Date,timer:null,updateStatics:false,delayAgain:true}}function _o_sortElements(_w_parameter){_o_throttle(sortParam,(async function(){let _w_list=null;if(typeof _w_parameter=="string"){_w_list=$(_w_parameter).toArray()}else{_w_list=_w_parameter}let _w_menuStatus=(await chrome.runtime.sendMessage({type:"readSetting",key:"_w_parka"})).value;let _w_sortBySize=(_w_menuStatus&4)>0;_w_list.sort((function(a,b){let _w_result=0;if(_w_sortBySize){_w_result=b.dataset.size-a.dataset.size}else{let _w_aRefererArray=a.refererSplitArray;let _w_bRefererArray=b.refererSplitArray;if(a.dataset.serial&&b.dataset.serial){_w_result=a.dataset.serial-b.dataset.serial}else if(_w_aRefererArray&&_w_bRefererArray&&_w_aRefererArray>_w_bRefererArray){_w_result=-1}else if(_w_aRefererArray&&_w_bRefererArray&&_w_aRefererArray<_w_bRefererArray){_w_result=1}}if(_w_result==0){return a.dataset.id-b.dataset.id}return _w_result}));for(let i=0;i<_w_list.length;++i){if(_w_list[i].parentNode){_w_list[i].parentNode.appendChild(_w_list[i])}}_o_dynamicRender(_w_parameter,true,true)}),false)}function _w_bore(_w_msg,_w_musket){if(_w_msg&&_w_msg.data&&_w_msg.data.id){let _w_fodder=document.querySelector(`a[data-id='${_w_msg.data.id}']`);if(!_w_fodder)return;const _w_rancor=_w_msg.data.grayHash;_w_fodder.dataset.phash=_w_rancor;if(!_w_musket&&_o_img_load_analyzer){_o_img_load_analyzer.storePhash(_w_fodder.dataset.src,_w_rancor)}const _w_ruse=[];let _w_amity=false;const _w_bonnet=_w_fodder.dataset.serial;const _w_swamp=parseInt(_w_fodder.dataset.size);const _w_ensign=_w_fodder.dataset.src.length;const _w_barb=parseInt(_w_rancor,16);const items=Array.from(document.querySelectorAll("a.imageItem[data-phash]")).map((item=>({element:item,hash:item.dataset.phash,hashInt:parseInt(item.dataset.phash,16),area:parseInt(item.dataset.size),srcLength:item.dataset.src.length,serial:item.dataset.serial})));items.forEach((_w_item=>{if(_w_amity)return;if(_w_item.element===_w_fodder)return;const _w_rite=((_w_barb^_w_item.hashInt)>>>0).toString(2);const _w_hush=(_w_rite.match(/1/g)||"").length;if(_w_hush>_w_scale)return;if(_w_item.area>_w_swamp||_w_item.area===_w_swamp&&(_w_rancor>_w_item.hashInt||_w_ensign>_w_item.srcLength)){console.log("去重(本体)："+_w_fodder.dataset.src);_w_fodder.remove();_w_ruse.splice(0);if(_w_item.serial>_w_bonnet){_w_item.element.dataset.serial=_w_bonnet}_w_amity=true;return}else{_w_ruse.push(_w_item.element);if(_w_item.serial<_w_fodder.dataset.serial){_w_fodder.dataset.serial=_w_item.serial}}}));if(!_w_amity){_w_ruse.forEach((item=>{console.log("去重(元素)："+item.dataset.src);item.remove()}))}}}function _o_createSerial(url){if(!window.fileDownloadCounter){window.fileDownloadCounter=10001}if(!window.urlSerialMapper){window.urlSerialMapper={}}if(!window.urlSerialMapper[url]){window.urlSerialMapper[url]=window.fileDownloadCounter++}return window.urlSerialMapper[url]}async function _w_ripple(_w_src,_w_comity){let _w_hawker=_o_img_load_analyzer.getFetchEntry(_w_src);let _w_lever=async function(_w_url){let _w_acme=(await chrome.runtime.sendMessage({type:"readSetting",key:"_w_glitch"})).value=="jpg"?"image/jpeg":"image/png";blobUtil.imgSrcToBlob(_w_url,_w_acme,"Anonymous",1).then((function(_w_blob){if(_o_isFunction(_w_comity)){let _w_succor=window.URL.createObjectURL(_w_blob);if(_w_hawker){_w_hawker._w_collar=_w_succor}_w_comity(_w_succor)}}))};if(_w_hawker&&_w_hawker._w_collar){_w_comity(_w_hawker._w_collar)}else if(_w_hawker&&_w_hawker._w_maven){await _w_lever(_w_hawker._w_maven)}else{await _w_lever(_w_src)}}function _o_downloadPathEscape(_w_path){if(_w_path){return _w_path.replace(/^[_\s\.]+/gi,"").replace(/[_\s\.]+$/gi,"").replace(/([\/\\]+)[_\s\.]+/gi,"$1").replace(/[_\s\.]+([\/\\]+)/gi,"$1").replace(/[\\\/]+/gi,"/").replace(/^\/+/gi,"")}return _w_path}function _o_filenameEscape(_w_filename,_w_allowSlash=false){if(_w_allowSlash){_w_filename=_w_filename.replace(/[\u200B-\u200D\uFEFF\x00-\x1F\x7F\x80-\x9F\n\r\f\s\t\v\\:\*\|\?'"<>%&^`\!\$\~|]+/gi,"_")}else{_w_filename=_w_filename.replace(/[\u200B-\u200D\uFEFF\x00-\x1F\x7F\x80-\x9F\n\r\f\s\t\v\\:\*\|\?'"<>%&^`\!\$\~|\/]+/gi,"_")}return _o_downloadPathEscape(_w_filename)}async function _w_rebate(_w_itemArray,_w_sting,_w_downloadFun,_w_callback){let _w_layman=async function(_w_task){async function _w_puddle(_w_downloadUrl){await chrome.downloads.download({url:_w_downloadUrl,filename:_o_filenameEscape(_w_task.filename,true),saveAs:false,conflictAction:"uniquify"})}if((await awaitWithTimeout(chrome.runtime.sendMessage({type:"_w_cipher",_w_suffix:_w_task.suffix}),false,500)).value){await _w_ripple(_w_task.src,_w_puddle)}else{await _w_puddle(_w_task.url)}};if(_w_downloadFun==null)_w_downloadFun=_w_layman;let _o_origin_title=_o_tabTitle;if(!_o_origin_title||_o_origin_title.length==0)folder=(new Date).toJSON();_o_origin_title=_o_filenameEscape(_o_origin_title);let _w_pathOriginTitle=_o_origin_title.substr(0,128);for(let item of _w_itemArray){item.order_serial=_o_createSerial(item.url);if(!item.serial){if(item.origin_serial){item.serial=item.origin_serial}else{item.serial=item.order_serial}}let _w_nerve=_w_sting._w_nerve;let _w_pageTitle=_o_getPageTitle(item.referer,_w_pathOriginTitle);let _w_pathPageTitle=_o_filenameEscape(_w_pageTitle,false).substr(0,128);let _w_momentTimeStamp=(await chrome.runtime.sendMessage({type:"_o_getExtTimeStamp",_w_extractorHash:_o_extractorHash})).value;let _w_pageHost=_o_extracHostname(item.referer);let _w_stroke=_w_adage(item.referer);_w_nerve=_w_nerve.replace(/\{page.title\}/gi,_w_pathPageTitle).replace(/\{page.search\}/gi,_w_stroke).replace(/\{page.host\}/gi,_w_pageHost).replace(/\{origin.title\}/gi,_w_pathOriginTitle).replace(/\{YYYY-MM-DD\}/gi,_w_momentTimeStamp.YYYYMMDD).replace(/\{HH-mm-ss\}/gi,_w_momentTimeStamp.HHmmss).replace(/\{extractor_hash\}/gi,_o_extractorHash);_w_nerve=_o_filenameEscape(_w_nerve,true);let _w_filename=item.filename;let _w_suffix=item.suffix;let _w_filenamePattern=_w_sting._w_filenamePattern;_w_filename=_w_filenamePattern.replace(/\{filename\}/gi,_w_filename).replace(/\{no.10001\}/gi,item.order_serial).replace(/\{origin_serial\}/gi,item.serial).replace(/\{page.title\}/gi,_w_pathPageTitle).replace(/\{origin.title\}/gi,_w_pathOriginTitle).replace(/\{page.search\}/gi,_w_stroke).replace(/\{page.host\}/gi,_w_pageHost).replace(/\{YYYY-MM-DD\}/gi,_w_momentTimeStamp.YYYYMMDD).replace(/\{HH-mm-ss\}/gi,_w_momentTimeStamp.HHmmss).replace(/\{extractor_hash\}/gi,_o_extractorHash);_w_filename=_o_filenameEscape(_w_filename)+_w_suffix;await _w_downloadFun({url:item.url,src:item.src,referer:item.referer,filename:_o_filenameEscape(_w_nerve+"/",true)+_w_filename,suffix:item.suffix})}if(_w_callback)await _w_callback()}async function _o_directDownload(_o_itemArray){let _w_sting={_w_nerve:localStorage["filePath_format"]!=undefined?localStorage["filePath_format"]:_w_hinge._w_streak[1],_w_filenamePattern:localStorage["filename_format"]?localStorage["filename_format"]:_w_hinge._w_gander[1]};await _w_rebate(_o_itemArray,_w_sting,null,null)}async function _w_flight(_o_itemArray,_o_cleanSelectedAndSelectAllItems){if($(".modal").is(":visible")||$(".modal").length>1){return}else if(_o_itemArray==undefined||_o_itemArray.length==0){alert(_MSG_("ext_pop_empty_download_list"));return}let $_w_dialog=$("<div />",{id:"download_confirm_dlg",class:"modal fade",role:"dialog"});let $_w_modalDlg=$("<div />",{class:"modal-dialog modal-xl"});let $_w_modalCnt=$("<div />",{class:"modal-content"});let $_w_modalHdr=$("<div />",{class:"modal-header"});let $_w_modalTle=$("<h4 />",{class:"modal-title",text:_MSG_("fn_download_modal_tle")});$_w_modalHdr.append($_w_modalTle);$_w_modalCnt.append($_w_modalHdr);let $_w_modalBdy=$("<div />",{class:"modal-body"});$_w_modalBdy.append(_MSG_("fn_download_modal_cnt"));let $_w_formContainer=$("<form />",{class:"form-horizontal"});$_w_formContainer.append($("<h4 />",{text:_MSG_("fn_download_modal_save_path")}));let $_w_downloadPathGrp=$("<div />",{class:"input-group"});let _w_sting={_w_nerve:"",_w_filenamePattern:""};let $_w_downloadDir=$("<input />",{class:"form-control",type:"text",value:localStorage["filePath_format"]!=undefined?localStorage["filePath_format"]:_w_hinge._w_streak[1]}).on("change input",(function(){localStorage["filePath_format"]=$(this).prop("value");_w_sting["_w_nerve"]=localStorage["filePath_format"]})).trigger("change");$_w_downloadPathGrp.append($_w_downloadDir);let $_w_filePathSwitchBtn=$("<div />",{class:"input-group-btn"});$_w_filePathSwitchBtn.append($("<button />",{type:"button",class:"btn btn-default dropdown-toggle","data-toggle":"dropdown"}).append($("<span />",{class:"caret"})));let $_w_filePathSwitchMenu=$("<ul />",{class:"dropdown-menu dropdown-menu-right"});_w_hinge._w_streak.forEach((_w_defaultFilePath=>{let $_w_switchRecommendFilePath=$("<a />",{href:"#",text:_w_defaultFilePath});$_w_switchRecommendFilePath.on("click",(function(){$_w_downloadDir.prop("value",$(this).text()).trigger("change")}));$_w_filePathSwitchMenu.append($("<li />").append($_w_switchRecommendFilePath))}));$_w_filePathSwitchBtn.append($_w_filePathSwitchMenu);$_w_downloadPathGrp.append($_w_filePathSwitchBtn);$_w_downloadPathGrp.append($("<span />",{class:"input-group-addon",text:"/"}));let $_w_downloadFileName=$("<input />",{type:"text",class:"form-control",value:localStorage["filename_format"]?localStorage["filename_format"]:_w_hinge._w_gander[1]}).on("change input",(function(){localStorage["filename_format"]=$(this).prop("value");_w_sting["_w_filenamePattern"]=localStorage["filename_format"]})).trigger("change");$_w_downloadPathGrp.append($_w_downloadFileName);let $_w_fileNameSwitchBtn=$("<div />",{class:"input-group-btn"});$_w_fileNameSwitchBtn.append($("<button />",{type:"button",class:"btn btn-default dropdown-toggle","data-toggle":"dropdown"}).append($("<span />",{class:"caret"})));let $_w_fileNameSwitchMenu=$("<ul />",{class:"dropdown-menu dropdown-menu-right"});_w_hinge._w_gander.forEach((_w_gloom=>{let $_w_poseur=$("<a />",{href:"#",text:_w_gloom});$_w_poseur.on("click",(function(){$_w_downloadFileName.prop("value",$(this).text()).trigger("change")}));$_w_fileNameSwitchMenu.append($("<li />").append($_w_poseur))}));$_w_fileNameSwitchBtn.append($_w_fileNameSwitchMenu);$_w_downloadPathGrp.append($_w_fileNameSwitchBtn);$_w_downloadPathGrp.append($("<span />",{class:"input-group-addon",text:".{suffix}"}));$_w_formContainer.append($("<div />",{class:"form-group"}).append($("<div />",{class:"col-md-12 col-sm-12"}).append($_w_downloadPathGrp)));$_w_modalBdy.append($_w_formContainer);$_w_modalCnt.append($_w_modalBdy);let $_w_modalFtr=$("<div />",{class:"modal-footer"});let $_w_curlScriptingBtn=$("<button />",{class:"btn btn-default unrelative_download",text:_MSG_("ext_pop_generate_curl_script")});$_w_curlScriptingBtn.prepend($("<span />",{class:"fa fa-terminal fa-lg"}));$_w_modalFtr.append($_w_curlScriptingBtn);let $_w_settingBtn=$("<button />",{class:"btn btn-default unrelative_download",text:_MSG_("fn_download_modal_btn_setting")});$_w_settingBtn.prepend($("<span />",{class:"glyphicon glyphicon-wrench"}));$_w_modalFtr.append($_w_settingBtn);let $_w_continuousSwitch=$("<input />",{type:"checkbox",name:"continuousSwitch"});$_w_modalFtr.append($("<span />",{class:"continuousSwitchContainer"}).append($_w_continuousSwitch));$_w_continuousSwitch.bootstrapSwitch({labelText:_MSG_("ext_pop_auto_download"),labelWidth:100,onSwitchChange:function(_,state){if(state==true){$(".unrelative_download").hide()}else{$(".unrelative_download").show()}}});let $_w_continueBtn=$("<button />",{class:"btn btn-default",text:_MSG_("fn_download_modal_btn_continue")});$_w_continueBtn.prepend($("<span />",{class:"glyphicon glyphicon-download"}));$_w_modalFtr.append($_w_continueBtn);let $_w_cancelBtn=$("<button />",{class:"btn btn-default","data-dismiss":"modal",text:_MSG_("fn_download_modal_btn_cancel")});$_w_cancelBtn.prepend($("<span />",{class:"glyphicon glyphicon-remove"}));$_w_modalFtr.append($_w_cancelBtn);$_w_modalCnt.append($_w_modalFtr);$_w_modalDlg.append($_w_modalCnt);$_w_dialog.append($_w_modalDlg);$_w_dialog.modal({backdrop:"static",keyboard:false}).on("hidden.bs.modal",(function(){$(this).remove()})).on("shown.bs.modal",(function(){if($(".modal:visible").length>1){$(".modal:visible:not(:first)").modal("hide")}}));$_w_curlScriptingBtn.on("click",(async function(){let $_w_curlScriptContainer=$_w_formContainer.find("#curlScriptContainer");let $_w_scriptTypeOptionCMD=$_w_formContainer.find("#scriptTypeOptionCMD");let $_w_scriptTypeOptionShell=$_w_formContainer.find("#scriptTypeOptionShell");let _w_scriptTypeOptionCMD="";let _w_scriptTypeOptionShell="";let _w_isPlatformWindows=navigator.platform.toLocaleLowerCase().indexOf("win")==0;if($_w_curlScriptContainer.length==0){let $_w_curlScriptTle=$("<h4 />",{text:_MSG_("ext_pop_curl_script")});$_w_scriptTypeOptionCMD=$("<div />",{id:"scriptTypeOptionCMD",class:"btn btn-default "+(_w_isPlatformWindows?"btn-primary":""),text:"CMD"});$_w_scriptTypeOptionShell=$("<div />",{id:"scriptTypeOptionShell",class:"btn btn-default "+(_w_isPlatformWindows?"":"btn-primary"),text:"Shell"});$_w_curlScriptTle.append($("<div />",{class:"btn-group btn-group-xs btn-group-vertical","data-toggle":"buttons"}).append($_w_scriptTypeOptionCMD).append($_w_scriptTypeOptionShell));$_w_curlScriptContainer=$("<textarea />",{id:"curlScriptContainer",rows:16,class:"form-control"});$_w_formContainer.append($("<div />",{class:"unrelative_download"}).append($_w_curlScriptTle).append($("<div />",{class:"form-group"}).append($("<div />",{class:"col-md-12 col-sm-12"}).append($_w_curlScriptContainer))));$($_w_scriptTypeOptionCMD).on("click",(function(){$(this).addClass("btn-primary");$_w_scriptTypeOptionShell.removeClass("btn-primary");$_w_curlScriptContainer.prop("value",_w_scriptTypeOptionCMD)}));$($_w_scriptTypeOptionShell).on("click",(function(){$(this).addClass("btn-primary");$_w_scriptTypeOptionCMD.removeClass("btn-primary");$_w_curlScriptContainer.prop("value",_w_scriptTypeOptionShell)}))}else{_w_scriptTypeOptionCMD="";_w_scriptTypeOptionShell="";$_w_curlScriptContainer.prop("value","")}await _w_rebate(_o_itemArray,_w_sting,(async function(_w_task){if(!_o_isAccessibleUrl(_w_task.src))return;let _w_taskReferer=encodeURI(decodeURI(_w_task.referer));let _w_acceptedLanguage=navigator.languages?navigator.languages.toString():navigator.language.toString();let _w_userAgent=navigator.userAgent;_w_scriptTypeOptionCMD+="\n";_w_scriptTypeOptionCMD+='curl -L "'+_w_task.src+'" -o "'+_w_task.filename.replace(/\//g,"\\")+'" --create-dirs -H "Accept: image/*,*/*;q=0.8" -H "Connection: keep-alive" -H "Accept-Encoding: gzip, deflate, sdch" -H "Referer: '+_w_taskReferer+'" -H "Accept-Language: '+_w_acceptedLanguage+';q=0.8" -H "User-Agent: '+_w_userAgent+'" -k --retry 4';_w_scriptTypeOptionCMD+="\n";_w_scriptTypeOptionShell+="\n";_w_scriptTypeOptionShell+='curl -L "'+_w_task.src+'" -o "'+_w_task.filename.replace(/\//g,"/")+'" --create-dirs -H "Accept: image/*,*/*;q=0.8" -H "Connection: keep-alive" -H "Accept-Encoding: gzip, deflate, sdch" -H "Referer: '+_w_taskReferer+'" -H "Accept-Language: '+_w_acceptedLanguage+';q=0.8" -H "User-Agent: '+_w_userAgent+'" -k --retry 4';_w_scriptTypeOptionShell+="\n";$_w_curlScriptContainer.prop("value",$_w_scriptTypeOptionCMD.hasClass("btn-primary")?_w_scriptTypeOptionCMD:_w_scriptTypeOptionShell)}),null)}));$_w_settingBtn.on("click",(function(){chrome.tabs.create({url:"chrome://settings/?search="+_MSG_("fn_download_modal_download_setting_search")})}));$_w_continueBtn.on("click",(async function(){let _w_doContinuousDownload=$_w_continuousSwitch.is(":checked");if(_w_doContinuousDownload){$(this).prop("disabled",true);$_w_formContainer.find("input,select, button").prop("disabled",true);$_w_continuousSwitch.bootstrapSwitch("disabled",true)}if(_w_doContinuousDownload){await async function continueDownloadFun(_o_itemArray){await _w_rebate(_o_itemArray,_w_sting,null,(async function(){if($_w_dialog.is(":visible")){let _w__continuous_itemArray=_o_cleanSelectedAndSelectAllItems();setTimeout((async()=>{await continueDownloadFun(_w__continuous_itemArray)}),2e3)}}))}(_o_itemArray);chrome.notifications.create("",{type:"basic",iconUrl:"./images/icon512.png",title:_MSG_("ext_pop_auto_downloading"),message:_MSG_("ext_pop_auto_download_msg")})}else{await _w_rebate(_o_itemArray,_w_sting,null,null);$_w_dialog.modal("hide");chrome.notifications.create("",{type:"basic",iconUrl:"./images/icon512.png",title:_MSG_("fn_notification_download_done_title"),message:_MSG_("fn_notification_download_done_msg")})}}));$_w_cancelBtn.on("click",(function(){}));if(!chrome.downloads||!chrome.downloads.download){$_w_settingBtn.attr("disabled",true);$_w_continueBtn.attr("disabled",true);chrome.notifications.create("",{type:"basic",iconUrl:"./images/icon512.png",title:_MSG_("ext_pop_download_api_not_found"),message:_MSG_("ext_pop_download_api_not_found_msg")},(function(notificationId){}))}}function _o_throttle(_w_param,_w_fun,_w_tempDelay){function execMe(){_w_param.lastExeTime=new Date;_w_fun()}_w_param.timer&&clearTimeout(_w_param.timer);if((new Date).getTime()-_w_param.lastExeTime.getTime()>_w_param.timeout){execMe()}else{_w_param.timer=setTimeout(execMe,_w_param.timeout);(_w_param.delayAgain||_w_tempDelay)&&(_w_param.lastExeTime=new Date)}}function _o_sizeItemExt(_o_image_size,_w_addReverseItem){for(let i=0;i<_o_image_size.length;++i){let _w_name=_o_image_size[i];let _w_value=_w_name.split("x");_o_image_size[_w_name]={width:_w_value[0],height:_w_value[1]};let _w_reverse_name=_o_image_size[_w_name].height+"x"+_o_image_size[_w_name].width;if(_w_addReverseItem&&_o_image_size.indexOf(_w_reverse_name)==-1){_o_image_size.push(_w_reverse_name);_o_image_size[_w_reverse_name]={width:_o_image_size[_w_name].height,height:_o_image_size[_w_name].width}}}return _o_sizeItemSort(_o_image_size)}function _o_sizeItemSort(_o_image_size){_o_image_size.sort((function(a,b){let _w_elem_a=_o_image_size[a];let _w_elem_b=_o_image_size[b];return _w_elem_a.width-_w_elem_b.width>0?1:_w_elem_a.width-_w_elem_b.width<0?-1:_w_elem_a.height-_w_elem_b.height>0?1:_w_elem_a.height-_w_elem_b.height<0?-1:0}));return _o_image_size}async function _o_randomFingerChar(){let _w_clientFinger=null;let _w_key=_o_randomCharSerial();if(typeof ServiceWorkerGlobalScope!=="undefined"&&self instanceof ServiceWorkerGlobalScope){_w_clientFinger=await _o_getClientFinger()}else{_w_clientFinger=(await chrome.runtime.sendMessage({type:"readSetting",key:"_w_mirage"})).value}_w_clientFinger=_w_key+_o_pwdEncrypt(_w_key,_o_getExtensionId()+_w_clientFinger);return _w_clientFinger}function _o_pwdEncrypt(_w_key,_w_originalStr){let _w_n=_w_key.indexOf("0")%16+1;for(;_w_n>0;--_w_n){_w_originalStr=_o_offsetEncrypt(_w_key,_w_originalStr)}return _w_originalStr}function _o_pwdDecrypt(_w_key,_w_originalStr){let _w_n=_w_key.indexOf("0")%16+1;for(;_w_n>0;--_w_n){_w_originalStr=_o_offsetDecrypt(_w_key,_w_originalStr)}return _w_originalStr}function _o_offsetEncrypt(_w_key,_w_originalStr){let _w_keyArray=_w_key.toLowerCase().split("");let _w_originalArray=_w_originalStr.toLowerCase().split("");let _w_sampleArray=_o_charSeed.toLowerCase().split("");let _w_offsetedArray=new Array;for(let i=0;i<_w_originalArray.length;++i){_w_offsetedArray.push(_w_keyArray[_w_sampleArray.indexOf(_w_originalArray[i])])}return _w_offsetedArray.join("")}function _o_offsetDecrypt(_w_key,_w_originalStr){let _w_keyArray=_w_key.toLowerCase().split("");let _w_originalArray=_w_originalStr.toLowerCase().split("");let _w_sampleArray=_o_charSeed.toLowerCase().split("");let _w_offsetedArray=new Array;for(let i=0;i<_w_originalArray.length;++i){_w_offsetedArray.push(_w_sampleArray[_w_keyArray.indexOf(_w_originalArray[i])])}return _w_offsetedArray.join("")}function _o_randomMax(l){if(isNaN(l)){l=0}return parseInt(Math.random()*l)}function _o_randomChar(l){let _w_x=_o_charSeed;let _w_tmp="";for(let i=0;i<l;++i){_w_tmp+=_w_x.charAt(Math.ceil(Math.random()*1e8)%_w_x.length)}return _w_tmp}function _o_randomCharSerial(){let _w_x=_o_charSeed.split("");let _w_serial="";while(_w_x.length>0){let _w_fPos=Math.ceil(Math.random()*1e8)%_w_x.length;_w_serial+=_w_x.splice(_w_fPos,1)[0]}return _w_serial}function _o_randomHex(l){let _w_x=_o_hexSeed;let _w_tmp="";for(let i=0;i<l;++i){_w_tmp+=_w_x.charAt(Math.ceil(Math.random()*1e8)%_w_x.length)}return _w_tmp}function _o_randomNumber(l){let _w_x=_o_numberSeed;let _w_tmp="";for(let i=0;i<l;++i){_w_tmp+=_w_x.charAt(Math.ceil(Math.random()*1e8)%_w_x.length)}return _w_tmp}Number.parseInt=function(data){return parseInt(data)};function _o_pathConvert(_w_baseURI,_w_relativePath){if(!_w_relativePath)return _w_baseURI||"";if(!_w_baseURI)return _w_relativePath;function _w_axle(path){try{new URL(path);return true}catch{return false}}if(_w_relativePath.startsWith("data:")||_w_axle(_w_relativePath)){return _w_relativePath}let _w_mitten;try{_w_mitten=new URL(_w_baseURI)}catch{return""}const domainRegex=/^\/\/([a-zA-Z0-9-]{1,63}\.)*[a-zA-Z]{2,}$/;if(domainRegex.test(_w_relativePath)){return _w_mitten.protocol+_w_relativePath}try{return new URL(_w_relativePath,_w_mitten).href}catch{return""}}function _w_fault(svgTag){return`data:image/svg+xml;utf8,${encodeURIComponent(svgTag)}`}function _o_timeSeed(){return"0."+((new Date).getTime()/1e3/3600/24/7).toFixed(0)}function _o_randomRequestURL(_w_url,_w_randStr){if(!_w_url){return""}else if(_w_url.indexOf("data:")==0){return _w_url}if(_w_url.indexOf("#")>0){_w_url=_w_url.substring(0,_w_url.indexOf("#"))}if(!_w_randStr||_w_randStr.trim()=="")_w_randStr=Math.random();if(_w_url.indexOf("?")>0){_w_url+="&"+_w_randStr}else{_w_url+="?"+_w_randStr}return _w_url}function _o_sendThirdPartHandleMsg(url,action){let _w_message={type:"_o_chuli3rdXinxi",url:url,action:action,createNewTab:true};chrome.runtime.sendMessage(_o_getExtensionId(),_w_message);return _w_message}function _o_sendMsgToCloseTab(){chrome.runtime.sendMessage(chrome.runtime.id,{type:"_o_guanbiTab"})}function _o_getQueryLanguange(){let _w_acceptedLanguages=["en-US","zh-CN","zh-TW"];let _w_queryLanguange=navigator.language;if(_w_acceptedLanguages.indexOf(_w_queryLanguange)<0)_w_queryLanguange=_w_acceptedLanguages[0];return _w_queryLanguange}function _o_googleRelativeInfo(url){let _w_googleRequestUrl="https://www.google.com/searchbyimage?hl="+_o_getQueryLanguange()+"&image_url="+encodeURIComponent(decodeURI(url));return _o_sendThirdPartHandleMsg(_w_googleRequestUrl)}function _o_googleViewAllSize(url){let _w_googleRequestUrl="https://www.google.com/searchbyimage?hl="+_o_getQueryLanguange()+"&image_url="+encodeURIComponent(decodeURI(url));return _o_sendThirdPartHandleMsg(_w_googleRequestUrl,"_o_googleViewAllSize_")}function _o_googleViewAnalogous(url){let _w_googleRequestUrl="https://www.google.com/searchbyimage?hl="+_o_getQueryLanguange()+"&image_url="+encodeURIComponent(decodeURI(url));return _o_sendThirdPartHandleMsg(_w_googleRequestUrl,"_o_googleViewAnalogous_")}function _o_googleImageSearchKeyword(keyword){let _w_googleRequestUrl="https://www.google.com/search?tbm=isch&hl="+navigator.language+"&q="+encodeURIComponent(keyword);return _o_sendThirdPartHandleMsg(_w_googleRequestUrl,"_o_extThisPage")}function _o_baiduImageSearchKeyword(keword){let _w_baiduRequestUrl="http://image.baidu.com/search/index?tn=baiduimage&word="+encodeURIComponent(keword);return _o_sendThirdPartHandleMsg(_w_baiduRequestUrl,"_o_extThisPage")}function _o_ajaxCallback(ajaxParam,_o_PrefetchedDataHandle){let _o_callbackProxyFun=function(data,status,xhr){_o_PrefetchedDataHandle(data,status,xhr,ajaxParam.url)};if(window.location.protocol=="http:"||window.location.protocol=="https:"){_o_backgroundAjax(ajaxParam,_o_callbackProxyFun)}else{if(!window.funExecutePool){window.funExecutePool=_o_createTaskExecutePool(4)}window.funExecutePool.addTask((function(beginFun,endFun){beginFun();$.ajax(ajaxParam).always(endFun).always(_o_callbackProxyFun)}))}}function _o_backgroundAjax(requestParam,callbackFun){if(!requestParam||!requestParam.url){callbackFun();return}requestParam.url=_o_pathConvert(window.location.href,requestParam.url);let _w_requestHash=_o_randomChar(64);if(!_o_background_ajax_seted){chrome.runtime.onMessage.addListener((function _o_bgAjxRespFun(message,sender,callback){if(message&&message.type=="_o_backgroundAjaxResponse"){if(message.status=="success"){message.xhr.getResponseHeader=function(headerName){return message.xhr.responseHeaders[headerName]}}if(_o_background_ajax_hash_mapper[message.requestHash]){let _w_dealFun=_o_background_ajax_hash_mapper[message.requestHash];delete _o_background_ajax_hash_mapper[message.requestHash];_w_dealFun=_w_dealFun(message.data,message.status,message.xhr)}}}));let _o_background_ajax_seted=true}_o_background_ajax_hash_mapper[_w_requestHash]=callbackFun;chrome.runtime.sendMessage(chrome.runtime.id,{type:"_o_houtaiQingqiu",requestParam:requestParam,requestHash:_w_requestHash})}function _o_isServiceSite(url){try{let _w_url=new URL(_w_url);if(_w_url.href.startsWith(_o_multiURLExtDefURL)){return false}else if(_w_url.hostname.endsWith("cxyz.info")||_w_url.hostname.endsWith("pullywood.com")){return true}else{return false}}catch(exception){return false}}function _o_isExtensionPage(url){try{let _w_url=new URL(_w_url);if(_w_url.host==chrome.runtime.id){return true}else{return false}}catch(exception){return false}}function _o_RestoreUrlFromServiceSite(url){if(url.indexOf("#")>0)url=url.substring(0,url.indexOf("#"));if(/^.*?([\?&]0\.\d{4,6})+$/.test(url)){return url.replace(/([\?&]0\.\d{4,6})+$/,"")}else{return url}}async function _o_isAllowedFileSchemeAccess(){if(chrome&&chrome.extension&&chrome.extension.isAllowedFileSchemeAccess){return await chrome.extension.isAllowedFileSchemeAccess()}return false}(async function(){let _o_isAllowed=false;if(typeof chrome!="undefined"&&typeof chrome.extension!="undefined"&&typeof chrome.extension.isAllowedFileSchemeAccess!="undefined"){_o_isAllowed=await new Promise((resolve=>{chrome.extension.isAllowedFileSchemeAccess((function(isAllowed){resolve(isAllowed)}))}))}_o_isAllowed=function(){return _o_isAllowed}})();function _o_isMultiExtUrl(url){return new URL(url).pathname=="/multiUrlExtractor.html"||new URL(url).pathname=="/blank.html"}async function _o_isAccessibleUrl(url){let _w_accessibleProtocols=["http:","https:","ftp:","data:","about:"];let _w_localFileProtocol="file:";if(await _o_isAllowedFileSchemeAccess()){_w_accessibleProtocols.push(_w_localFileProtocol)}try{url=new URL(url);return _w_accessibleProtocols.indexOf(url.protocol)>=0}catch(exception){return false}}function _o_formatURL(url){if(!url||url==""||url.startsWith("data:"))return url;if(url.indexOf("#")>=0)url=url.substring(0,url.indexOf("#"));return url.trim()}if(!global.qrcodeMessageHandlerRegisted){chrome.runtime.onMessage.addListener((function(message,sender,callback){if(message&&message.type=="_o_createQRCode"){_o_createQRCode(message.text,true)}}));global.qrcodeMessageHandlerRegisted=true}function _o_createQRCode(text,showTitle){let _o_qrCodeDialogId="_o_qrCodeDialogId";let _w_scrollInfo={};_w_scrollInfo.scrollX=window.scrollX;_w_scrollInfo.scrollY=window.scrollY;let $_w_bootstrapCssTag=$("<link />",{rel:"stylesheet",type:"text/css",href:chrome.runtime.getURL("libs/bootstrap/3.4.1/css/bootstrap.min.css")});$("head").append($_w_bootstrapCssTag);let $_w_qrCodeModal=$("#"+_o_qrCodeDialogId);if($_w_qrCodeModal.length>0)$_w_qrCodeModal.modal("hide");$_w_qrCodeModal=$("<div />",{id:_o_qrCodeDialogId,class:"modal fade",style:"z-index:999999999",role:"dialog"});let $_w_modalDlg=$("<div />",{class:"modal-dialog"});let $_w_modalCnt=$("<div />",{class:"modal-content"});let $_w_modalHdr=$("<div />",{class:"modal-header",style:"overflow:hidden; word-wrap: break-word; word-break: break-all;"});let $_w_modalHdrCloseBtn=$("<button />",{class:"close","data-dismiss":"modal",text:"x"});$_w_modalHdr.append($_w_modalHdrCloseBtn);if(showTitle){let $_w_modalTle=$("<h4 />",{class:"modal-title",style:"overflow:hidden; word-wrap: break-word; word-break: break-all;",text:text.trim()});$_w_modalHdr.append($_w_modalTle)}$_w_modalCnt.append($_w_modalHdr);let $_w_modalBdy=$("<div />",{class:"modal-body",style:"overflow:hidden; word-wrap: break-word; word-break: break-all;"});$_w_modalCnt.append($_w_modalBdy);let $_w_modalFtr=$("<div />",{class:"modal-footer",style:"overflow:hidden; word-wrap: break-word; word-break: break-all;"});$_w_modalFtr.append('Generated By <a target="_pullywood_" href="https://www.pullywood.com/ImageAssistant/">'+_MSG_("opt_brand_text")+"</a>");$_w_modalCnt.append($_w_modalFtr);$_w_modalDlg.append($_w_modalCnt);$_w_qrCodeModal.append($_w_modalDlg);$_w_qrCodeModal.modal({keyboard:true}).on("shown.bs.modal",(function(e){function dynamicSizeQRCode(qrCodeSize){$_w_modalBdy.html("");if(!qrCodeSize){let _w_maxWidth=$_w_modalBdy.width()-30;let _w_maxHeight=$_w_modalBdy[0].getBoundingClientRect?window.innerHeight-$_w_modalBdy[0].getBoundingClientRect().top-30:_w_maxWidth;qrCodeSize=_w_maxWidth>_w_maxHeight?_w_maxHeight:_w_maxWidth}let _w_qrCode=null;let _w_correctLevels=[QRCode.CorrectLevel.L,QRCode.CorrectLevel.M,QRCode.CorrectLevel.Q,QRCode.CorrectLevel.H];while(!_w_qrCode&&_w_correctLevels.length>0){try{let _w_qrCodeLevel=_w_correctLevels.pop();_w_qrCode=new QRCode($_w_modalBdy.get(0),{text:text.trim(),width:qrCodeSize,height:qrCodeSize,colorDark:"#000000",colorLight:"#ffffff",correctLevel:_w_qrCodeLevel})}catch(exception){$_w_modalBdy.html("")}}_w_qrCode=undefined}$(window).on("resize",(function(){dynamicSizeQRCode()})).resize()})).on("hidden.bs.modal",(function(e){$_w_bootstrapCssTag.remove();$(this).remove();window.scrollTo(_w_scrollInfo.scrollX,_w_scrollInfo.scrollY)}))}function _o_Qrcd(_w_text,_w_qrCodeSize,_w_fgColor,_w_bgColor){let _w_container=document.createElement("div");let _w_qrCode=null;let _w_correctLevels=[QRCode.CorrectLevel.L,QRCode.CorrectLevel.M,QRCode.CorrectLevel.Q,QRCode.CorrectLevel.H];while(!_w_qrCode&&_w_correctLevels.length>0){try{let _w_qrCodeLevel=_w_correctLevels.pop();_w_qrCode=new QRCode(_w_container,{text:_w_text.trim(),width:_w_qrCodeSize,height:_w_qrCodeSize,colorDark:_w_fgColor,colorLight:_w_bgColor,correctLevel:_w_qrCodeLevel})}catch(exception){}}_w_qrCode=undefined;let _w_images=_w_container.getElementsByTagName("img");if(_w_images&&_w_images.length>0){return _w_images[0]}}function _o_numberToFixedLengthStr(_w_numValue,_w_length){let _w_sampleStr="00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";if(typeof _w_numValue=="undefined"||typeof _w_length=="undefined"||isNaN(_w_length))return"";_w_length=Number.parseInt(_w_length);if(_w_length>128)_w_length=128;_w_numValue=_w_numValue.toString();if(_w_numValue.length<_w_length){_w_length-=_w_numValue.length;_w_numValue=_w_sampleStr.substr(0,_w_length)+_w_numValue}return _w_numValue}function _o_escapeHtml(_w_string){return String(_w_string).replace(/[&<>"'\/]/g,(function(s){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}[s]}))}function _o_escapeRegexp(string){return string.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function _o_isExcludeURL(url){if(!url){return true}else if(url.indexOf(_o_extStatisticURL)==0||url.indexOf(_o_extStatisticURL.replace("http://","https://"))==0){return true}else if(url.match(/^https?:\/\/(img|image|)\d*\.cxyz\.info\/.*/i)){return true}return false}function _o_rewriteBrowserPopup(){window.alert=function(alert){console.log("window.alert: "+alert)};window.confirm=function(confirm){console.log("window.confirm: "+confirm,", return true");return true};window.prompt=function(prompt){console.log("window.prompt: "+prompt,', return ""');return""}}async function _o_continuousScrollToBottom(_w_timeout=1e3,checkVisible=false){if(typeof window==="undefined")return;_o_rewriteBrowserPopup();if(typeof global._o_continuousScrollToBottomSwitch=="undefined"){global._o_continuousScrollToBottomSwitch=true;setInterval((function(){let _o_currentPageYOffset=window.scrollY;if(!_o_currentPageYOffset){_o_currentPageYOffset=0}let _w_minScroll=window.innerHeight>100?window.innerHeight:100;if(window.scrollY-_o_currentPageYOffset>=_w_minScroll/2){chrome.runtime.sendMessage(_o_getExtensionId(),{type:"_o_notifyGunDong"})}}),100);let _w_suture=8;setInterval((async function(){if(checkVisible&&document.hidden)return;const reqNum=(await chrome.runtime.sendMessage(_o_getExtensionId(),{type:"_w_sleigh"})).value;if(reqNum<_w_suture){window.scrollBy(0,window.innerHeight)}}),_w_timeout)}}function _o_init_set(){let _o_container={};return{add:function(item){_o_container[item]=true},has:function(item){if(_o_container[item]){return true}else{return false}},size:function(){return Object.keys(_o_container).length}}}function _o_extracHostname(url){let _w_host="";try{_w_host=new URL(url).host}catch(exception){}return _w_host}function _o_createImageLoadTimeoutSiteAnalyzer(_w_timeout,_w_count){let _w_tangle={};let _w_bypassThreshold=_w_count;let _w_analysis={};let _w_counterFun=function(host,inTime,outOfTime){if(typeof _w_analysis[host]=="undefined"){_w_analysis[host]=[0,0]}inTime&&_w_analysis[host][0]++;outOfTime&&_w_analysis[host][1]++};let _w_isBypassHost=function(host){if(_w_analysis[host]&&_w_analysis[host][0]==0&&_w_analysis[host][1]>=_w_bypassThreshold){return true}else{return false}};return{setImgSrc:function(img,src,forceFetch=false){let _w_host=_o_extracHostname(src);let _w_loadTimeout=false;if(!_w_tangle[src])_w_tangle[src]={};let _w_hawker=_w_tangle[src];let _w_maven=_w_hawker._w_maven;if(src&&(forceFetch||!_w_maven)){let _w_mammal=new AbortController;let _w_rival=_w_mammal.signal;let _w_timer=setTimeout((function(){_w_counterFun(false,true);_w_loadTimeout=true;_w_mammal.abort()}),_w_timeout);(_w_groove?fetch:fetch)(src,{_w_rival:_w_rival}).then((resp=>{_w_hawker._w_status=resp.status;if(resp.headers){let _w_intent=resp.headers.get("content-disposition");if(_w_intent){let match=_w_intent.match(/filename\=['"]?([^'"]+)['"]?;/i);let _w_filename=match?decodeURIComponent(match[1]):null;_w_hawker._w_filename=_w_filename}}return resp.blob()})).then((async function(blob){let _w_fury=await _w_slab(blob);if(_w_fury==="unknown"){let match=blob.type.match(/^(image\/.*?)$/i);_w_fury=match?_w_taper[match[1].toLowerCase()]:null}let _w_maven=URL.createObjectURL(blob);URL.revokeObjectURL(_w_hawker._w_maven);URL.revokeObjectURL(_w_hawker._w_enmity);URL.revokeObjectURL(_w_hawker._w_carat);URL.revokeObjectURL(_w_hawker._w_collar);delete _w_hawker._w_maven;delete _w_hawker._w_enmity;delete _w_hawker._w_carat;delete _w_hawker._w_collar;_w_hawker._w_fury=_w_fury;_w_hawker._w_maven=_w_maven;img.src=_w_maven;_w_counterFun(_w_host,true,false)})).catch((function(e){img.src=null})).finally((function(){clearTimeout(_w_timer)}))}else{img.src=_w_maven}return{isTimeout:function(){return _w_loadTimeout},getFetchEntry:function(){return _w_hawker}}},directSetImgSrc:function(img,src){img.src=src;return{isTimeout:function(){return false},getFetchEntry:function(){return{}}}},bypassUrl:function(url){if(typeof url=="undefined"){return true}let _w_host=_o_extracHostname(url);if(_w_host==""){return true}return _w_isBypassHost(_w_host)},getStatus:function(){return JSON.stringify(_w_analysis)},getBypassSite:function(){let _w_arr=[];Object.keys(_w_analysis).forEach((function(host){if(_w_isBypassHost(host)){_w_arr.push(host)}}));return _w_arr},storePhash:function(src,phash){if(_w_tangle[src]){_w_tangle[src]._w_plume=phash}},getFetchEntry:function(src){return _w_tangle[src]}}}function _o_downloadText(_w_filename,_w_content){let _w_a=document.createElement("a");let _w_blob=new Blob([_w_content],{type:"text/plain;charset=UTF-8"});_w_a.href=window.URL.createObjectURL(_w_blob);_w_a.download=_w_filename;_w_a.style.display="none";document.body.appendChild(_w_a);_w_a.click();_w_a=undefined}function _o_createBatchAjaxPool(_w_taskExecutePool){let _w_executePool=null;if(typeof _w_taskExecutePool=="number"){_w_executePool=_o_createTaskExecutePool(_w_taskExecutePool)}else if(_o_isFunction(_w_taskExecutePool.addTask)&&_o_isFunction(_w_taskExecutePool.setMax)){_w_executePool=_w_taskExecutePool}else{_w_executePool=_o_createTaskExecutePool(8)}let _w_ajaxFun=function(_w_method,_w_url,_w_headers,_w_data,_w_doneFun,_w_failFun,_w_alwaysFun){_w_executePool.addTask((function(beginFun,endFun){let _w_payload=null;try{_w_payload=JSON.stringify(_w_data)}catch(exception){}beginFun();$.ajax({method:_w_method,url:_w_url,timeout:_o_ajax_request_timeout,headers:_w_headers,data:_w_payload,contentType:"application/json"}).always(endFun).done(_w_doneFun).fail(_w_failFun).always(_w_alwaysFun)}))};return{ajaxGet:function(_w_url,_w_headers,_w_data,_w_doneFun,_w_failFun,_w_alwaysFun){_w_ajaxFun("GET",_w_url,_w_headers,_w_data,_w_doneFun,_w_failFun,_w_alwaysFun)},ajaxPost:function(_w_url,_w_headers,_w_data,_w_doneFun,_w_failFun,_w_alwaysFun){_w_ajaxFun("POST",_w_url,_w_headers,_w_data,_w_doneFun,_w_failFun,_w_alwaysFun)},setMax:function(max){_w_executePool.setMax(max)},getProcessingNum:function(){return _w_executePool.getProcessingNum()},getTaskNum:function(){return _w_executePool.getTaskNum()}}}function _o_commonUrlComplete(_w_urls,_w_regexp,_w_tIdx,_w_pIdx){let _w_characteristicArray=[];let _w_characteristicFormat=null;let _w_emptyFirst=false;_w_urls.forEach((function(url){let _w_regResult=_w_regexp.exec(url);if(_w_regResult){_w_characteristicFormat=_w_regResult;_w_characteristicArray.push([_w_characteristicFormat[_w_tIdx],parseInt(_w_characteristicFormat[_w_pIdx]?_w_characteristicFormat[_w_pIdx]:1)]);if(_w_characteristicFormat[_w_pIdx]==""){_w_emptyFirst=true}}}));_w_characteristicArray.sort((function(a,b){let _w_result=a[0].localeCompare(b[0]);if(_w_result==0){_w_result=a[1]-b[1]}return _w_result}));let _w_outputs_0=Array.from(_w_urls);let _w_outputs_1=[];function createUrlByCharacteristic(_w_characteristicFormat,_w_tIdx,_w_pIdx,_w_tId,_w_pId,_w_emptyFirst){let _w_newUrl="";if(_w_emptyFirst&&_w_pId==1){_w_pId=""}for(let k=1;k<_w_characteristicFormat.length;++k){if(k==_w_tIdx){_w_newUrl=_w_newUrl.concat(_w_tId)}else if(k==_w_pIdx){_w_newUrl=_w_newUrl.concat(_w_pId)}else if(k==_w_pIdx-1&&_w_pId==""&&_w_characteristicFormat[k].length>0&&(_w_characteristicFormat[k].substr(-1)=="_"||_w_characteristicFormat[k].substr(-1)=="_")){_w_newUrl.concat(_w_characteristicFormat[k].slice(0,-1))}else{_w_newUrl=_w_newUrl.concat(_w_characteristicFormat[k])}}return _w_newUrl}for(let i=0;i<_w_characteristicArray.length;++i){let _w_maxIdx=_w_characteristicArray.length-1;let _w_doPush=function(){_w_outputs_1.push(createUrlByCharacteristic(_w_characteristicFormat,_w_tIdx,_w_pIdx,_w_characteristicArray[i][0],_w_characteristicArray[i][1],_w_emptyFirst))};if(_w_characteristicArray.length==1){_w_doPush()}else if(i==0){item.serial;if(_w_characteristicArray[i][0]!=_w_characteristicArray[i+1][0]){_w_doPush()}}else if(i==_w_maxIdx){if(_w_characteristicArray[i-1][0]!=_w_characteristicArray[i][0]){_w_doPush()}}else if(_w_characteristicArray[i-1][0]!=_w_characteristicArray[i][0]&&_w_characteristicArray[i][0]!=_w_characteristicArray[i+1][0]){_w_doPush()}if(i==_w_maxIdx){continue}if(_w_characteristicArray[i][0]==_w_characteristicArray[i+1][0]&&_w_characteristicArray[i+1][1]-_w_characteristicArray[i][1]>1){for(let j=_w_characteristicArray[i][1]+1;j<_w_characteristicArray[i+1][1];++j){let _w_newUrl=createUrlByCharacteristic(_w_characteristicFormat,_w_tIdx,_w_pIdx,_w_characteristicArray[i][0],j);_w_outputs_0.push(_w_newUrl)}}}console.log("old urls length: "+_w_urls.length+", new Urls length: "+_w_outputs_0.length+", single Urls length: "+_w_outputs_1.length);return[Array.from(new Set(_w_outputs_0)),Array.from(new Set(_w_outputs_1))]}async function asyncUrlToBlobUrl(url){return await(_w_groove?fetch:fetch)(url,{mode:"cors",headers:{"Access-Control-Allow-Origin":"*"}}).then((response=>response.blob())).then((function(blob){return URL.createObjectURL(blob)}))}