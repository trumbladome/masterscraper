{"version":3,"file":"background.js","mappings":"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","sources":["webpack://dtalite/./lib/background.ts","webpack://dtalite/external var \"crypto\"","webpack://dtalite/webpack/bootstrap","webpack://dtalite/webpack/runtime/chunk loaded","webpack://dtalite/webpack/runtime/define property getters","webpack://dtalite/webpack/runtime/hasOwnProperty shorthand","webpack://dtalite/webpack/runtime/make namespace object","webpack://dtalite/webpack/runtime/jsonp chunk loading","webpack://dtalite/webpack/before-startup","webpack://dtalite/webpack/startup","webpack://dtalite/webpack/after-startup"],"sourcesContent":["\"use strict\";\n// License: MIT\n\nimport { ALLOWED_SCHEMES, TRANSFERABLE_PROPERTIES } from \"./constants\";\nimport { API } from \"./api\";\nimport { Finisher, makeUniqueItems } from \"./item\";\nimport { Prefs } from \"./prefs\";\nimport { _, locale } from \"./i18n\";\nimport { openPrefs, openManager } from \"./windowutils\";\nimport { filters } from \"./filters\";\nimport { getManager } from \"./manager/man\";\nimport {\n  browserAction as action,\n  menus as _menus, contextMenus as _cmenus,\n  tabs,\n  webNavigation as nav,\n  // eslint-disable-next-line no-unused-vars\n  Tab,\n  // eslint-disable-next-line no-unused-vars\n  MenuClickInfo,\n  CHROME,\n  runtime,\n  history,\n  sessions,\n  // eslint-disable-next-line no-unused-vars\n  OnInstalled,\n} from \"./browser\";\nimport { Bus } from \"./bus\";\nimport { filterInSitu } from \"./util\";\nimport { DB } from \"./db\";\n\n\nconst menus = typeof (_menus) !== \"undefined\" && _menus || _cmenus;\n\nconst GATHER = \"/bundles/content-gather.js\";\n\nconst CHROME_CONTEXTS = Object.freeze(new Set([\n  \"all\",\n  \"audio\",\n  \"browser_action\",\n  \"editable\",\n  \"frame\",\n  \"image\",\n  \"launcher\",\n  \"link\",\n  \"page\",\n  \"page_action\",\n  \"selection\",\n  \"video\",\n]));\n\nasync function runContentJob(tab: Tab, file: string, msg: any) {\n  try {\n    if (tab && tab.incognito && msg) {\n      msg.private = tab.incognito;\n    }\n    const res = await tabs.executeScript(tab.id, {\n      file,\n      allFrames: true,\n      runAt: \"document_start\"\n    });\n    if (!msg) {\n      return res;\n    }\n    const promises = [];\n    const results: any[] = [];\n    for (const frame of await nav.getAllFrames({ tabId: tab.id })) {\n      promises.push(tabs.sendMessage(tab.id, msg, {\n        frameId: frame.frameId}\n      ).then(function(res: any) {\n        results.push(res);\n      }).catch(console.error));\n    }\n    await Promise.all(promises);\n    return results;\n  }\n  catch (ex) {\n    console.error(\"Failed to execute content script\", file,\n      ex.message || ex.toString(), ex);\n    return [];\n  }\n}\n\ntype SelectionOptions = {\n  selectionOnly: boolean;\n  allTabs: boolean;\n  turbo: boolean;\n  tab: Tab;\n};\n\n\nclass Handler {\n  async processResults(turbo = false, results: any[]) {\n    const links = this.makeUnique(results, \"links\");\n    const media = this.makeUnique(results, \"media\");\n    await API[turbo ? \"turbo\" : \"regular\"](links, media);\n  }\n\n  makeUnique(results: any[], what: string) {\n    return makeUniqueItems(\n      results.filter(e => e[what]).map(e => {\n        const finisher = new Finisher(e);\n        return filterInSitu(e[what].\n          map((item: any) => finisher.finish(item)), e => !!e);\n      }));\n  }\n\n  async performSelection(options: SelectionOptions) {\n    try {\n      const tabOptions: any = {\n        currentWindow: true,\n        discarded: false,\n      };\n      if (!CHROME) {\n        tabOptions.hidden = false;\n      }\n      const selectedTabs = options.allTabs ?\n        await tabs.query(tabOptions) as any[] :\n        [options.tab];\n\n      const textLinks = await Prefs.get(\"text-links\", true);\n      const gatherOptions = {\n        type: \"DTA:gather\",\n        selectionOnly: options.selectionOnly,\n        textLinks,\n        schemes: Array.from(ALLOWED_SCHEMES.values()),\n        transferable: TRANSFERABLE_PROPERTIES,\n      };\n\n      const results = await Promise.all(selectedTabs.\n        map((tab: any) => runContentJob(tab, GATHER, gatherOptions)));\n\n      await this.processResults(options.turbo, results.flat());\n    }\n    catch (ex) {\n      console.error(ex.toString(), ex.stack, ex);\n    }\n  }\n}\n\nfunction getMajor(version?: string) {\n  if (!version) {\n    return \"\";\n  }\n  const match = version.match(/^\\d+\\.\\d+/);\n  if (!match) {\n    return \"\";\n  }\n  return match[0];\n}\n\nruntime.onInstalled.addListener(({reason, previousVersion}: OnInstalled) => {\n  const {version} = runtime.getManifest();\n  const major = getMajor(version);\n  const prevMajor = getMajor(previousVersion);\n  if (reason === \"update\" && major !== prevMajor) {\n    tabs.create({\n      url: `https://about.downthemall.org/changelog/?cur=${major}&prev=${prevMajor}`,\n    });\n  }\n  else if (reason === \"install\") {\n    tabs.create({\n      url: `https://about.downthemall.org/4.0/?cur=${major}`,\n    });\n  }\n});\n\nlocale.then(() => {\n  const menuHandler = new class Menus extends Handler {\n    constructor() {\n      super();\n      this.onClicked = this.onClicked.bind(this);\n      const alls = new Map<string, string[]>();\n      const menuCreate = (options: any) => {\n        if (CHROME) {\n          delete options.icons;\n          options.contexts = options.contexts.\n            filter((e: string) => CHROME_CONTEXTS.has(e));\n          if (!options.contexts.length) {\n            return;\n          }\n        }\n        if (options.contexts.includes(\"all\")) {\n          alls.set(options.id, options.contexts);\n        }\n        menus.create(options);\n      };\n      menuCreate({\n        id: \"DTARegularLink\",\n        contexts: [\"link\"],\n        icons: {\n          16: \"/style/button-regular.png\",\n          32: \"/style/button-regular@2x.png\",\n        },\n        title: _(\"dta.regular.link\"),\n      });\n      menuCreate({\n        id: \"DTATurboLink\",\n        contexts: [\"link\"],\n        icons: {\n          16: \"/style/button-turbo.png\",\n          32: \"/style/button-turbo@2x.png\",\n        },\n        title: _(\"dta.turbo.link\"),\n      });\n      menuCreate({\n        id: \"DTARegularImage\",\n        contexts: [\"image\"],\n        icons: {\n          16: \"/style/button-regular.png\",\n          32: \"/style/button-regular@2x.png\",\n        },\n        title: _(\"dta.regular.image\"),\n      });\n      menuCreate({\n        id: \"DTATurboImage\",\n        contexts: [\"image\"],\n        icons: {\n          16: \"/style/button-turbo.png\",\n          32: \"/style/button-turbo@2x.png\",\n        },\n        title: _(\"dta.turbo.image\"),\n      });\n      menuCreate({\n        id: \"DTARegularMedia\",\n        contexts: [\"video\", \"audio\"],\n        icons: {\n          16: \"/style/button-regular.png\",\n          32: \"/style/button-regular@2x.png\",\n        },\n        title: _(\"dta.regular.media\"),\n      });\n      menuCreate({\n        id: \"DTATurboMedia\",\n        contexts: [\"video\", \"audio\"],\n        icons: {\n          16: \"/style/button-turbo.png\",\n          32: \"/style/button-turbo@2x.png\",\n        },\n        title: _(\"dta.turbo.media\"),\n      });\n      menuCreate({\n        id: \"DTARegularSelection\",\n        contexts: [\"selection\"],\n        icons: {\n          16: \"/style/button-regular.png\",\n          32: \"/style/button-regular@2x.png\",\n        },\n        title: _(\"dta.regular.selection\"),\n      });\n      menuCreate({\n        id: \"DTATurboSelection\",\n        contexts: [\"selection\"],\n        icons: {\n          16: \"/style/button-turbo.png\",\n          32: \"/style/button-turbo@2x.png\",\n        },\n        title: _(\"dta.turbo.selection\"),\n      });\n      menuCreate({\n        id: \"DTARegular\",\n        contexts: [\"all\", \"browser_action\", \"tools_menu\"],\n        icons: {\n          16: \"/style/button-regular.png\",\n          32: \"/style/button-regular@2x.png\",\n        },\n        title: _(\"dta.regular\"),\n      });\n      menuCreate({\n        id: \"DTATurbo\",\n        contexts: [\"all\", \"browser_action\", \"tools_menu\"],\n        icons: {\n          16: \"/style/button-turbo.png\",\n          32: \"/style/button-turbo@2x.png\",\n        },\n        title: _(\"dta.turbo\"),\n      });\n      menuCreate({\n        id: \"sep-1\",\n        contexts: [\"all\", \"browser_action\", \"tools_menu\"],\n        type: \"separator\"\n      });\n      menuCreate({\n        id: \"DTARegularAll\",\n        contexts: [\"all\", \"browser_action\", \"tools_menu\"],\n        icons: {\n          16: \"/style/button-regular.png\",\n          32: \"/style/button-regular@2x.png\",\n        },\n        title: _(\"dta-regular-all\"),\n      });\n      menuCreate({\n        id: \"DTATurboAll\",\n        contexts: [\"all\", \"browser_action\", \"tools_menu\"],\n        icons: {\n          16: \"/style/button-turbo.png\",\n          32: \"/style/button-turbo@2x.png\",\n        },\n        title: _(\"dta-turbo-all\"),\n      });\n      const sep2ctx = menus.ACTION_MENU_TOP_LEVEL_LIMIT === 6 ?\n        [\"all\", \"tools_menu\"] :\n        [\"all\", \"browser_action\", \"tools_menu\"];\n      menuCreate({\n        id: \"sep-2\",\n        contexts: sep2ctx,\n        type: \"separator\"\n      });\n      menuCreate({\n        id: \"DTAAdd\",\n        contexts: [\"all\", \"browser_action\", \"tools_menu\"],\n        icons: {\n          16: \"/style/add.svg\",\n          32: \"/style/add.svg\",\n          64: \"/style/add.svg\",\n          128: \"/style/add.svg\",\n        },\n        title: _(\"add-download\"),\n      });\n      menuCreate({\n        id: \"sep-3\",\n        contexts: [\"all\", \"browser_action\", \"tools_menu\"],\n        type: \"separator\"\n      });\n      menuCreate({\n        id: \"DTAManager\",\n        contexts: [\"all\", \"browser_action\", \"tools_menu\"],\n        icons: {\n          16: \"/style/button-manager.png\",\n          32: \"/style/button-manager@2x.png\",\n        },\n        title: _(\"manager.short\"),\n      });\n      menuCreate({\n        id: \"DTAPrefs\",\n        contexts: [\"all\", \"browser_action\", \"tools_menu\"],\n        icons: {\n          16: \"/style/settings.svg\",\n          32: \"/style/settings.svg\",\n          64: \"/style/settings.svg\",\n          128: \"/style/settings.svg\",\n        },\n        title: _(\"prefs.short\"),\n      });\n      Object.freeze(alls);\n\n      const adjustMenus = (v: boolean) => {\n        for (const [id, contexts] of alls.entries()) {\n          const adjusted = v ?\n            contexts.filter(e => e !== \"all\") :\n            contexts;\n          menus.update(id, {\n            contexts: adjusted\n          });\n        }\n      };\n      Prefs.get(\"hide-context\", false).then((v: boolean) => {\n      // This is the initial load, so no need to adjust when visible already\n        if (!v) {\n          return;\n        }\n        adjustMenus(v);\n      });\n      Prefs.on(\"hide-context\", (prefs, key, value: boolean) => {\n        adjustMenus(value);\n      });\n\n      menus.onClicked.addListener(this.onClicked);\n    }\n\n    *makeSingleItemList(url: string, results: any[]) {\n      for (const result of results) {\n        const finisher = new Finisher(result);\n        for (const list of [result.links, result.media]) {\n          for (const e of list) {\n            if (e.url !== url) {\n              continue;\n            }\n            const finished = finisher.finish(e);\n            if (!finished) {\n              continue;\n            }\n            yield finished;\n          }\n        }\n      }\n    }\n\n    async findSingleItem(tab: Tab, url: string, turbo = false) {\n      if (!url) {\n        return;\n      }\n      const results = await runContentJob(\n        tab, \"/bundles/content-gather.js\", {\n          type: \"DTA:gather\",\n          selectionOnly: false,\n          schemes: Array.from(ALLOWED_SCHEMES.values()),\n          transferable: TRANSFERABLE_PROPERTIES,\n        });\n      const found = Array.from(this.makeSingleItemList(url, results));\n      const unique = makeUniqueItems([found]);\n      if (!unique.length) {\n        return;\n      }\n      const [item] = unique;\n      API[turbo ? \"singleTurbo\" : \"singleRegular\"](item);\n    }\n\n    onClicked(info: MenuClickInfo, tab: Tab) {\n      if (!tab.id) {\n        return;\n      }\n      const {menuItemId} = info;\n      const {[`onClicked${menuItemId}`]: handler}: any = this;\n      if (!handler) {\n        console.error(\"Invalid Handler for\", menuItemId);\n        return;\n      }\n      const rv: Promise<void> | void = handler.call(this, info, tab);\n      if (rv && rv.catch) {\n        rv.catch(console.error);\n      }\n    }\n\n    async emulate(action: string) {\n      const tab = await tabs.query({\n        active: true,\n        currentWindow: true,\n      });\n      if (!tab || !tab.length) {\n        return;\n      }\n      this.onClicked({\n        menuItemId: action\n      }, tab[0]);\n    }\n\n    async onClickedDTARegular(info: MenuClickInfo, tab: Tab) {\n      return await this.performSelection({\n        selectionOnly: false,\n        allTabs: false,\n        turbo: false,\n        tab,\n      });\n    }\n\n    async onClickedDTARegularAll(info: MenuClickInfo, tab: Tab) {\n      return await this.performSelection({\n        selectionOnly: false,\n        allTabs: true,\n        turbo: false,\n        tab,\n      });\n    }\n\n    async onClickedDTARegularSelection(info: MenuClickInfo, tab: Tab) {\n      return await this.performSelection({\n        selectionOnly: true,\n        allTabs: false,\n        turbo: false,\n        tab,\n      });\n    }\n\n    async onClickedDTATurbo(info: MenuClickInfo, tab: Tab) {\n      return await this.performSelection({\n        selectionOnly: false,\n        allTabs: false,\n        turbo: true,\n        tab,\n      });\n    }\n\n    async onClickedDTATurboAll(info: MenuClickInfo, tab: Tab) {\n      return await this.performSelection({\n        selectionOnly: false,\n        allTabs: true,\n        turbo: true,\n        tab,\n      });\n    }\n\n    async onClickedDTATurboSelection(info: MenuClickInfo, tab: Tab) {\n      return await this.performSelection({\n        selectionOnly: true,\n        allTabs: false,\n        turbo: true,\n        tab,\n      });\n    }\n\n    async onClickedDTARegularLink(info: MenuClickInfo, tab: Tab) {\n      if (!info.linkUrl) {\n        return;\n      }\n      await this.findSingleItem(tab, info.linkUrl, false);\n    }\n\n    async onClickedDTATurboLink(info: MenuClickInfo, tab: Tab) {\n      if (!info.linkUrl) {\n        return;\n      }\n      await this.findSingleItem(tab, info.linkUrl, true);\n    }\n\n    async onClickedDTARegularImage(info: MenuClickInfo, tab: Tab) {\n      if (!info.srcUrl) {\n        return;\n      }\n      await this.findSingleItem(tab, info.srcUrl, false);\n    }\n\n    async onClickedDTATurboImage(info: MenuClickInfo, tab: Tab) {\n      if (!info.srcUrl) {\n        return;\n      }\n      await this.findSingleItem(tab, info.srcUrl, true);\n    }\n\n    async onClickedDTARegularMedia(info: MenuClickInfo, tab: Tab) {\n      if (!info.srcUrl) {\n        return;\n      }\n      await this.findSingleItem(tab, info.srcUrl, false);\n    }\n\n    async onClickedDTATurboMedia(info: MenuClickInfo, tab: Tab) {\n      if (!info.srcUrl) {\n        return;\n      }\n      await this.findSingleItem(tab, info.srcUrl, true);\n    }\n\n    onClickedDTAAdd() {\n      API.singleRegular(null);\n    }\n\n    async onClickedDTAManager() {\n      await openManager();\n    }\n\n    async onClickedDTAPrefs() {\n      await openPrefs();\n    }\n  }();\n\n  new class Action extends Handler {\n    constructor() {\n      super();\n      this.onClicked = this.onClicked.bind(this);\n      action.onClicked.addListener(this.onClicked);\n      Prefs.get(\"button-type\", false).then(v => this.adjust(v));\n      Prefs.on(\"button-type\", (prefs, key, value) => {\n        this.adjust(value);\n      });\n    }\n\n    adjust(type: string) {\n      action.setPopup({\n        popup: type !== \"popup\" ? \"\" : \"/windows/popup.html\"\n      });\n      let icons;\n      switch (type) {\n      case \"popup\":\n        icons = {\n          16: \"/style/icon16.png\",\n          32: \"/style/icon32.png\",\n          48: \"/style/icon48.png\",\n          64: \"/style/icon64.png\",\n          128: \"/style/icon128.png\",\n          256: \"/style/icon256.png\"\n        };\n        break;\n\n      case \"dta\":\n        icons = {\n          16: \"/style/button-regular.png\",\n          32: \"/style/button-regular@2x.png\",\n        };\n        break;\n\n      case \"turbo\":\n        icons = {\n          16: \"/style/button-turbo.png\",\n          32: \"/style/button-turbo@2x.png\",\n        };\n        break;\n\n      case \"manager\":\n        icons = {\n          16: \"/style/button-manager.png\",\n          32: \"/style/button-manager@2x.png\",\n        };\n        break;\n      }\n      action.setIcon({path: icons});\n    }\n\n    async onClicked() {\n      switch (await Prefs.get(\"button-type\")) {\n      case \"popup\":\n        break;\n\n      case \"dta\":\n        menuHandler.emulate(\"DTARegular\");\n        break;\n\n      case \"turbo\":\n        menuHandler.emulate(\"DTATurbo\");\n        break;\n\n      case \"manager\":\n        menuHandler.emulate(\"DTAManager\");\n        break;\n      }\n    }\n  }();\n\n\n  Bus.on(\"do-regular\", () => menuHandler.emulate(\"DTARegular\"));\n  Bus.on(\"do-regular-all\", () => menuHandler.emulate(\"DTARegularAll\"));\n  Bus.on(\"do-turbo\", () => menuHandler.emulate(\"DTATurbo\"));\n  Bus.on(\"do-turbo-all\", () => menuHandler.emulate(\"DTATurboAll\"));\n  Bus.on(\"do-single\", () => API.singleRegular(null));\n  Bus.on(\"open-manager\", () => openManager(true));\n  Bus.on(\"open-prefs\", () => openPrefs());\n\n  (async function init() {\n    const urlBase = runtime.getURL(\"\");\n    try {\n      history.onVisited.addListener(({url}: {url: string}) => {\n        if (!url || !url.startsWith(urlBase)) {\n          return;\n        }\n        history.deleteUrl({url});\n      });\n      const results: {url?: string}[] = await history.search({text: urlBase});\n      for (const {url} of results) {\n        if (!url) {\n          continue;\n        }\n        history.deleteUrl({url});\n      }\n    }\n    catch (ex) {\n      console.error(\"Failed to clean history\", ex);\n    }\n\n    if (!CHROME) {\n      try {\n        const sessionRemover = async () => {\n          for (const s of await sessions.getRecentlyClosed()) {\n            try {\n              if (s.tab && s.tab.url && s.tab.sessionId) {\n                if (s.tab.url.startsWith(urlBase)) {\n                  await sessions.forgetClosedTab(\n                    s.tab.windowId, s.tab.sessionId);\n                }\n                continue;\n              }\n              if (!s.window || !s.window.tabs || s.window.tabs.length > 1) {\n                continue;\n              }\n              const [tab] = s.window.tabs;\n              if (tab.url.startsWith(urlBase) && s.window.sessionId) {\n                await sessions.forgetClosedWindow(s.window.sessionId);\n              }\n            }\n            catch (ex) {\n              console.error(\"failed to remove session entry\", ex);\n            }\n          }\n        };\n        sessions.onChanged.addListener(sessionRemover);\n        await sessionRemover();\n      }\n      catch (ex) {\n        console.error(\"failed to install session remover\", ex);\n      }\n    }\n\n    try {\n      await DB.init();\n    }\n    catch (ex) {\n      console.error(\"db init\", ex.toString(), ex.message, ex.stack, ex);\n    }\n\n    await Prefs.set(\"last-run\", new Date());\n    await filters();\n    await getManager();\n  })().catch(ex => {\n    console.error(\"Failed to init components\", ex.toString(), ex.stack, ex);\n  });\n});\n","module.exports = crypto;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t\"background\": 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkdtalite\"] = self[\"webpackChunkdtalite\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [\"common\"], () => (__webpack_require__(\"./lib/background.ts\")))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n",""],"names":[],"sourceRoot":""}